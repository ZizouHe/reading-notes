
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Factor Calendar Â· Reading List & Notes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-image-captions/image-captions.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../notes/temp.html" />
    
    
    <link rel="prev" href="mln.html" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"buttons":[{"user":"ZizouHe","repo":"reading-notes","type":"star","size":"small"}]};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="already.html">
            
                <a href="already.html">
            
                    
                    Finished List
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="bayes.html">
            
                <a href="bayes.html">
            
                    
                    Bayesian Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="DL.html">
            
                <a href="DL.html">
            
                    
                    Deep Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="fin.html">
            
                <a href="fin.html">
            
                    
                    Finance/Quant Finance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="CS.html">
            
                <a href="CS.html">
            
                    
                    General CS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="DS.html">
            
                <a href="DS.html">
            
                    
                    General Data Science
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="ML.html">
            
                <a href="ML.html">
            
                    
                    Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="opt.html">
            
                <a href="opt.html">
            
                    
                    Numerical and Optimization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="stat.html">
            
                <a href="stat.html">
            
                    
                    Traditional Statistics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="book.html">
            
                <a href="book.html">
            
                    
                    Books
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="broker.html">
            
                <a href="broker.html">
            
                    
                    Broker Reports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="qfn.html">
            
                <a href="qfn.html">
            
                    
                    Quant Finance Notes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="mln.html">
            
                <a href="mln.html">
            
                    
                    Machine Learning Notes
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.13" data-path="factor_cal.html">
            
                <a href="factor_cal.html">
            
                    
                    Factor Calendar
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="../notes/temp.html">
            
                <a href="../notes/temp.html">
            
                    
                    Reading Todo List
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="reading.html">
            
                <a href="reading.html">
            
                    
                    Reading List
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="bayesing.html">
            
                <a href="bayesing.html">
            
                    
                    Bayesian Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="DLing.html">
            
                <a href="DLing.html">
            
                    
                    Deep Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="MLing.html">
            
                <a href="MLing.html">
            
                    
                    Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="opting.html">
            
                <a href="opting.html">
            
                    
                    Numerical and Optimization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="stating.html">
            
                <a href="stating.html">
            
                    
                    Traditional Statistics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="booking.html">
            
                <a href="booking.html">
            
                    
                    Books
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="notes.html">
            
                <a href="notes.html">
            
                    
                    Notes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../notes/NeuralODE.html">
            
                <a href="../notes/NeuralODE.html">
            
                    
                    Neural ODE
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../notes/RDN.html">
            
                <a href="../notes/RDN.html">
            
                    
                    Relational Dependency Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../notes/LDA.html">
            
                <a href="../notes/LDA.html">
            
                    
                    LDA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../notes/KSD_test.html">
            
                <a href="../notes/KSD_test.html">
            
                    
                    KSD for Goodness-of-fit Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../notes/LTK_test.html">
            
                <a href="../notes/LTK_test.html">
            
                    
                    LTK Goodness-of-Fit Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../notes/GaussMixCompress.html">
            
                <a href="../notes/GaussMixCompress.html">
            
                    
                    Sample Complexity Bounds for Gaussian Mixtures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../notes/SGMCMC.html">
            
                <a href="../notes/SGMCMC.html">
            
                    
                    A Complete Recipe for SGMCMC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../notes/Sharpe_Minima_Works.html">
            
                <a href="../notes/Sharpe_Minima_Works.html">
            
                    
                    Sharpe Minima Can Generalize
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../notes/Sharpe_Minima_Exp.html">
            
                <a href="../notes/Sharpe_Minima_Exp.html">
            
                    
                    Large Batch Training and Sharpe Minima
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../notes/RMLHMC.html">
            
                <a href="../notes/RMLHMC.html">
            
                    
                    Riemann Manifold Langevin and HMC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../notes/pathSGD.html">
            
                <a href="../notes/pathSGD.html">
            
                    
                    Path-SGD: Path-normalized Optimization in Deep Neural Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../notes/Empirical_Loss.html">
            
                <a href="../notes/Empirical_Loss.html">
            
                    
                    Empirical Analysis of DNN Loss Surfaces
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../notes/Good_Semi_Bad_GAN.html">
            
                <a href="../notes/Good_Semi_Bad_GAN.html">
            
                    
                    Good Semi-supervised Learning that Requires a Bad GAN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../notes/Faster_Frank_Wolfe.html">
            
                <a href="../notes/Faster_Frank_Wolfe.html">
            
                    
                    Faster Rates for Frank-Wolfe over Strongly-Convex Sets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../notes/Fin_Fan_Book.html">
            
                <a href="../notes/Fin_Fan_Book.html">
            
                    
                    The Element of Financial Econometrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.16" data-path="../notes/Double_ML.html">
            
                <a href="../notes/Double_ML.html">
            
                    
                    Double machine learning for treatment effect
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.17" data-path="../notes/RL_Book1.html">
            
                <a href="../notes/RL_Book1.html">
            
                    
                    Part 1: Reinforcement Learning: An Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.18" data-path="../notes/RL_Book2.html">
            
                <a href="../notes/RL_Book2.html">
            
                    
                    Part 2: Reinforcement Learning: An Introduction (2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.19" data-path="../notes/TRPO.html">
            
                <a href="../notes/TRPO.html">
            
                    
                    Trust Region Policy Optimization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.20" data-path="../notes/Prior_Exp_Replay.html">
            
                <a href="../notes/Prior_Exp_Replay.html">
            
                    
                    Prioritized Experience Replay
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.21" data-path="../notes/stein-galton.html">
            
                <a href="../notes/stein-galton.html">
            
                    
                    A Galtonian Perspective on Shrinkage Estimators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.22" data-path="../notes/lasso.html">
            
                <a href="../notes/lasso.html">
            
                    
                    Regression Shrinkage and Selection via the Lasso
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.23" data-path="../notes/nonpa_inst.html">
            
                <a href="../notes/nonpa_inst.html">
            
                    
                    Nonparametric Instrumental Regression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.24" data-path="../notes/defi_RFS.html">
            
                <a href="../notes/defi_RFS.html">
            
                    
                    Decentralized mining in centralized pools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.25" data-path="../notes/ES_2014_majority.html">
            
                <a href="../notes/ES_2014_majority.html">
            
                    
                    Majority is not enough: Bitcoin mining is vulnerable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.26" data-path="../notes/lazy-prices.html">
            
                <a href="../notes/lazy-prices.html">
            
                    
                    Lazy Prices
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.27" data-path="../notes/wager_athey_pnas_2021.html">
            
                <a href="../notes/wager_athey_pnas_2021.html">
            
                    
                    Confidence Intervals for Policy Evaluation in Adaptive Experiments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.28" data-path="../notes/kelly_zhang_2021_nips.html">
            
                <a href="../notes/kelly_zhang_2021_nips.html">
            
                    
                    Statistical Inference with M-Estimators on Adaptively Collected Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.29" data-path="../notes/realized_var.html">
            
                <a href="../notes/realized_var.html">
            
                    
                    Realized Variance and Market Microstructure Noise
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.30" data-path="../notes/PoS.html">
            
                <a href="../notes/PoS.html">
            
                    
                    Blockchain without waste: Proof-of-stake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.31" data-path="../notes/green_2019_jfe.html">
            
                <a href="../notes/green_2019_jfe.html">
            
                    
                    Crowdsourced employer reviews and stock returns
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.32" data-path="../notes/SoK.html">
            
                <a href="../notes/SoK.html">
            
                    
                    A Survey of Attacks on Ethereum Smart Contracts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.33" data-path="../notes/Lee_2019_jfe.html">
            
                <a href="../notes/Lee_2019_jfe.html">
            
                    
                    Technological Links and Predictable Returns
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.34" data-path="../notes/Da_2021_jfe.html">
            
                <a href="../notes/Da_2021_jfe.html">
            
                    
                    Extrapolative beliefs in the cross-section: What can we learn from the crowds?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.35" data-path="../notes/Parsons_2020_rfs.html">
            
                <a href="../notes/Parsons_2020_rfs.html">
            
                    
                    Geographic Lead-Lag Effects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.36" data-path="../notes/Ali_2020_jfe.html">
            
                <a href="../notes/Ali_2020_jfe.html">
            
                    
                    Shared Analyst Coverage: Unifying Momentum Spillover Effects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.37" data-path="../notes/q-factor.html">
            
                <a href="../notes/q-factor.html">
            
                    
                    Q-Factor Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.38" data-path="../notes/DHS-4-factors.html">
            
                <a href="../notes/DHS-4-factors.html">
            
                    
                    Short- and Long-Horizon Behavioral Factors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.39" data-path="../notes/Stambaugh-Yuan-2017.html">
            
                <a href="../notes/Stambaugh-Yuan-2017.html">
            
                    
                    Stambaugh-Yuan Four Factors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.40" data-path="../notes/cn_nlp.html">
            
                <a href="../notes/cn_nlp.html">
            
                    
                    Chinese NLP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.41" data-path="../notes/cn_shell.html">
            
                <a href="../notes/cn_shell.html">
            
                    
                    Chinese Stock Market Shell Value
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.42" data-path="../notes/cn_ff3.html">
            
                <a href="../notes/cn_ff3.html">
            
                    
                    Size and Value
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.43" data-path="../notes/retail.html">
            
                <a href="../notes/retail.html">
            
                    
                    Tracking Retail Investor Activity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.44" data-path="../notes/GCN.html">
            
                <a href="../notes/GCN.html">
            
                    
                    Graph Convolution and Graph Attention
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.45" data-path="../notes/phack.html">
            
                <a href="../notes/phack.html">
            
                    
                    P-hacking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.46" data-path="../notes/general_tech_dl.html">
            
                <a href="../notes/general_tech_dl.html">
            
                    
                    General Structures and Techniques in Deep Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.47" data-path="../notes/TCN.html">
            
                <a href="../notes/TCN.html">
            
                    
                    Temporal Convolutional Network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.48" data-path="../notes/whichbeta.html">
            
                <a href="../notes/whichbeta.html">
            
                    
                    Which Beta?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.49" data-path="../notes/OOS.html">
            
                <a href="../notes/OOS.html">
            
                    
                    Out of Sample Predictability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.50" data-path="../notes/FF3_cryoto.html">
            
                <a href="../notes/FF3_cryoto.html">
            
                    
                    Multi-factor in Cryptocurrency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.51" data-path="../notes/quant_ml.html">
            
                <a href="../notes/quant_ml.html">
            
                    
                    Quant Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.52" data-path="../notes/behave.html">
            
                <a href="../notes/behave.html">
            
                    
                    Behavioral Finance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.53" data-path="../notes/d-reduct.html">
            
                <a href="../notes/d-reduct.html">
            
                    
                    Nonlinear Dimension Reduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.54" data-path="../notes/moment.html">
            
                <a href="../notes/moment.html">
            
                    
                    Momentum
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.55" data-path="../notes/miscell.html">
            
                <a href="../notes/miscell.html">
            
                    
                    Lottery-like Stocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.56" data-path="../notes/tabnet.html">
            
                <a href="../notes/tabnet.html">
            
                    
                    TabNet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.57" data-path="../notes/kaggle-fin.html">
            
                <a href="../notes/kaggle-fin.html">
            
                    
                    Kaggle Finance Competition Solution Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.58" data-path="../notes/feature_int.html">
            
                <a href="../notes/feature_int.html">
            
                    
                    Feature Interaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.59" data-path="../notes/ESG.html">
            
                <a href="../notes/ESG.html">
            
                    
                    ESG
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.60" data-path="../notes/ivol.html">
            
                <a href="../notes/ivol.html">
            
                    
                    Idiosyncratic Volatility
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.61" data-path="../notes/volume.html">
            
                <a href="../notes/volume.html">
            
                    
                    Volume
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.62" data-path="../notes/overnight.html">
            
                <a href="../notes/overnight.html">
            
                    
                    Overnight Return Reserval
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.63" data-path="../notes/NAS.html">
            
                <a href="../notes/NAS.html">
            
                    
                    Neural Architecture Search
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.64" data-path="../notes/meta.html">
            
                <a href="../notes/meta.html">
            
                    
                    Meta Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.65" data-path="../notes/nominal_illusion.html">
            
                <a href="../notes/nominal_illusion.html">
            
                    
                    Nominal Price Ilusion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.66" data-path="../notes/co-trade.html">
            
                <a href="../notes/co-trade.html">
            
                    
                    Co-trade Network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.67" data-path="../notes/COI_flow_decomp.html">
            
                <a href="../notes/COI_flow_decomp.html">
            
                    
                    Order Imbalance with Trade Flow Decomposition
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.68" data-path="../notes/mlts.html">
            
                <a href="../notes/mlts.html">
            
                    
                    Time Seris Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.69" data-path="../notes/PEAD.html">
            
                <a href="../notes/PEAD.html">
            
                    
                    PEAD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.70" data-path="../notes/risk_parity.html">
            
                <a href="../notes/risk_parity.html">
            
                    
                    Risk Parity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.71" data-path="../notes/nlp_fin.html">
            
                <a href="../notes/nlp_fin.html">
            
                    
                    NLP in Finance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.72" data-path="../notes/self_super_tab.html">
            
                <a href="../notes/self_super_tab.html">
            
                    
                    Self-supervised Learning for Tabular Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.73" data-path="../notes/regime.html">
            
                <a href="../notes/regime.html">
            
                    
                    Regime Modeling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.74" data-path="../notes/fin_stat.html">
            
                <a href="../notes/fin_stat.html">
            
                    
                    Financial Statement Related
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.75" data-path="../notes/dl_fin.html">
            
                <a href="../notes/dl_fin.html">
            
                    
                    Deep Learning in Finance
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Factor Calendar</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#momentum"><b> </b>Momentum</a></li><li><span class="title-icon "></span><a href="#technical-indicator"><b> </b>Technical Indicator</a></li><li><span class="title-icon "></span><a href="#high-frequency"><b> </b>High Frequency</a></li><li><span class="title-icon "></span><a href="#risk-factor"><b> </b>Risk Factor</a></li></ul></div><a href="#momentum" id="anchorNavigationExGoTop"><i class="fa fa-arrow-up"></i></a><h1 id="momentum"><a name="momentum" class="anchor-navigation-ex-anchor" href="#momentum"><i class="fa fa-link" aria-hidden="true"></i></a> Momentum</h1>
<ul>
<li><p>Information Discreteness (ID)</p>
<ul>
<li><p><a href="https://www3.nd.edu/~zda/Frog.pdf" target="_blank">Da, Zhi, Umit G. Gurun, and Mitch Warachka. &quot;Frog in the pan: Continuous information and momentum.&quot; <em>The review of financial studies</em> 27.7 (2014): 2171-2218.</a></p>
</li>
<li><p>Definition
<script type="math/tex; mode=display">
    ID = \mathrm{sign} (PRET) \times (\%\mathrm{neg} - \% \mathrm{pos})
    </script>
where PRET is 12-1 month cumulative return, %neg and %pos are negative (positive) daily return percentage within the same period. Smaller ID value gives more positive return in the future.</p>
</li>
<li><p>Theory: frequent arrival of small signals draws less attention compared to infrequent but big signals. The former has underreaction and the latter has overreaction.</p>
</li>
</ul>
</li>
<li><p>Capital Gains Overhang (CGO) </p>
<ul>
<li><p><a href="https://www.sciencedirect.com/science/article/pii/S0304405X16301787" target="_blank">Wang, Huijun, Jinghua Yan, and Jianfeng Yu. &quot;Reference-dependent preferences and the risk&#x2013;return trade-off.&quot; <em>Journal of Financial Economics</em> 123.2 (2017): 395-414.</a></p>
</li>
<li><p>Definition
<script type="math/tex; mode=display">
    \begin{gathered}
    R P_t=\frac{1}{k} \sum_{n=1}^T\left(V_{t-n} \prod_{\tau=1}^{n-1}\left(1-V_{t-n+\tau}\right)\right) P_{t-n} \\
    C G O_t=\frac{P_{t-1}-R P_l}{P_{t-1}}
    \end{gathered}
    </script>
where  <script type="math/tex; ">V_t</script> is week-t turnover rate (volume / outShs), <script type="math/tex; ">P_t</script> is week-t close price. <script type="math/tex; ">RP_t</script> is reference price. Higher CGO has higher return.</p>
</li>
<li><p>Theory: Prospect Theory suggests that investors are risk-seeking in the loss domain and risk-averse in the gain domain relative to a reference point. Using Capital Gains Overhang (CGO) as a proxy for investors&#x2019; unrealized gains or losses, the authors find:</p>
<ul>
<li>Positive risk&#x2013;return relation among stocks with high CGO (i.e., investors have unrealized gains).</li>
<li>Negative risk&#x2013;return relation among stocks with low CGO (i.e., investors have unrealized losses).</li>
<li>When investors are holding stocks at a loss (low CGO), they may prefer high-risk stocks, driving down prices and expected returns.</li>
<li>When investors are in a gain position (high CGO), they behave more traditionally (risk-averse), and high-risk stocks yield higher expected returns.</li>
</ul>
</li>
<li><p>Thoughts: better to use CGO x risk proxy (TRISK / SRISK / Beta / etc) interaction.</p>
</li>
</ul>
</li>
<li><p>Acceleration Momentum</p>
<ul>
<li><p><a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2292895" target="_blank">Investor Attention, Visual Price Pattern, and Momentum Investing</a></p>
</li>
<li><p>Definition
<script type="math/tex; mode=display">
    P_{i, t}=\alpha+\beta t+\gamma t^2
    </script>
where <script type="math/tex; ">P_{i,t}</script> is stock-i price at day-t, t=[1, ..., n] is the past 1, ..., n days. Run a regression over the past t days and obtain <script type="math/tex; ">\gamma</script> as acceleration momentum. </p>
</li>
<li><p>Trade acceleration momentum <script type="math/tex; ">\gamma</script> or <script type="math/tex; ">\widehat{P}</script>.</p>
</li>
<li><p>Theory: acceleration draw investor attention and create overreaction. </p>
</li>
</ul>
</li>
<li><p>Return Seasonality</p>
<ul>
<li><a href="https://www.sciencedirect.com/science/article/pii/S0304405X0700195X" target="_blank">Heston, Steven L., and Ronnie Sadka. &quot;Seasonality in the cross-section of stock returns.&quot; <em>Journal of Financial Economics</em> 87.2 (2008): 418-445.</a></li>
<li>Definition: past N year same month average return can be used to predict stock performance in the current month (cross-sectionally).</li>
</ul>
</li>
<li><p>Rank Momentum</p>
<ul>
<li>Definition: each day take normalized (0-1) ascending rank of daily return. Each month take average, then take average within each lookback period.</li>
</ul>
</li>
<li><p>PEAD</p>
<ul>
<li>Definition: 3-day cumulative mret after earnings anouncement. </li>
</ul>
</li>
<li><p>&#x632F;&#x5E45;&#x5207;&#x5272;&#x52A8;&#x91CF;</p>
<ul>
<li>&#x5F00;&#x6E90;&#x91D1;&#x5DE5; | A&#x80A1;&#x5E02;&#x573A;&#x5982;&#x4F55;&#x6784;&#x9020;&#x52A8;&#x91CF;&#x56E0;&#x5B50;</li>
<li>Definition: &#x4EE5; 160 &#x4E2A;&#x4EA4;&#x6613;&#x65E5;&#x4F5C;&#x4E3A;&#x7A97;&#x53E3;&#x671F;&#xFF0C;&#x5C06;&#x632F;&#x5E45;&#x8F83;&#x4F4E;&#x7684; <script type="math/tex; ">\lambda \%</script> &#x4E2A;&#x4EA4;&#x6613;&#x65E5;&#x7684;&#x6DA8;&#x8DCC;&#x5E45;&#x52A0;&#x603B;&#xFF0C;&#x5F97;&#x5230;&#x52A8;&#x91CF;&#x56E0;&#x5B50;&#xFF0C;<script type="math/tex; ">\lambda \%</script> &#x53D6;&#x503C;&#x8303;&#x56F4;&#x5728; <script type="math/tex; ">[50 \%, 70 \%]</script> &#x3002;</li>
<li>Theory: &#x4F4E;&#x632F;&#x5E45;&#x6C34;&#x5E73;&#x4E0B;&#x6DA8;&#x8DCC;&#x5E45;&#x56E0;&#x5B50;&#x5448;&#x73B0;&#x52A8;&#x91CF;&#x6548;&#x5E94;&#xFF0C;&#x9AD8;&#x632F;&#x5E45;&#x6C34;&#x5E73;&#x4E0B;&#x6DA8;&#x8DCC;&#x5E45;&#x56E0;&#x5B50;&#x5448;&#x73B0;&#x53CD;&#x8F6C;&#x6548;&#x5E94;&#xFF0C;&#x5E76;&#x4E14;&#x52A8;&#x91CF;&#x6548;&#x5E94;&#x548C;&#x53CD;&#x8F6C;&#x6548;&#x5E94;&#x7684;&#x5206;&#x5E03;&#x548C;&#x5F3A;&#x5EA6;&#x5177;&#x6709;&#x4E0D;&#x5BF9;&#x79F0;&#x6027;&#x3002;</li>
<li>Thoughts: filter using risk model risk * multiplier</li>
</ul>
</li>
<li><p>Fundamental Implied Return</p>
<ul>
<li><p><a href="https://ink.library.smu.edu.sg/lkcsb_research/5157/" target="_blank">Huang, Dashan, Huacheng Zhang, and Guofu Zhou. &quot;Twin momentum: Fundamental trends matter.&quot; (2017): 1.</a></p>
</li>
<li><p>Definition: L-quarter moving average on some fundamental factors (EPS, ROE, ROA, APE, CPA, GPA, Payout ratio)</p>
<p><script type="math/tex; mode=display">
    M A_{i, t, L}^k=\frac{F_{i, t}+F_{i, t-1}+\cdots+F_{i, t-L+1}}{L}
    </script></p>
</li>
</ul>
</li>
</ul>
<pre><code>Run regression on the next month return:

{% math %}
R_{i, t}=\alpha_t+\sum_{k=1}^K \sum_{L=1,2,4,8} \beta_{L, t}^k M A_{i, t-1, L}^k+\varepsilon_{i, t}
{% endmath %}
Conduct prediction based on most recent fundamental factor MA and estimated coef
{% math %}
\mathrm{FIR}_{i, t}=\sum_{k=1}^K \sum_{L=1,2,4,8} \beta_{L, t}^k M A_{i, t, L}^k
{% endmath %}
</code></pre><ul>
<li>Theory: fundamental factor momentum.</li>
</ul>
<ul>
<li><p>Financial Linkage</p>
<ul>
<li>Use some accouting / financial factors to construct linkage.</li>
<li>Thoughts: Barra linkage.</li>
</ul>
</li>
<li><p>Time Series Momentum</p>
<ul>
<li><p><a href="https://www.sciencedirect.com/science/article/pii/S0304405X11002613" target="_blank">Moskowitz, Tobias J., Yao Hua Ooi, and Lasse Heje Pedersen. &quot;Time series momentum.&quot; <em>Journal of financial economics</em> 104.2 (2012): 228-250.</a></p>
</li>
<li><p>Definition: 
<script type="math/tex; mode=display">
    \mathrm{T S M O M}_{t i}=\operatorname{sign}\left(\frac{1}{N} \sum_{j=1}^{12} \hat{r}_{t-j, i}\right) \frac{1}{\widehat{\sigma}_{m, i}}
    </script>
where <script type="math/tex; ">\widehat{\sigma}_{m, i}</script> is the EMA monthly volatility and <script type="math/tex; ">\hat{r}_{t-j, i}</script> is the monthly excessive return (monthly return subtract EMA mean of monthly return)</p>
</li>
<li><p>Thoughts: using risk/realized volatility to adjust momentum.</p>
</li>
</ul>
</li>
</ul>
<h1 id="technical-indicator"><a name="technical-indicator" class="anchor-navigation-ex-anchor" href="#technical-indicator"><i class="fa fa-link" aria-hidden="true"></i></a> Technical Indicator</h1>
<ul>
<li><p>Rate of Change</p>
<ul>
<li><p>Definition
<script type="math/tex; mode=display">
    \mathrm{ROC} = \frac{\mathrm{Close}_t - \mathrm{Close}_{t-N}}{\mathrm{Close}_{t-N}}
    </script></p>
<p><script type="math/tex; mode=display">
    \mathrm{MAROC} = \mathrm{MA}(\mathrm{ROC}, M), \; \; \mathrm{EMAROC} = \mathrm{EMA}(\mathrm{ROC}, M)
    </script></p>
</li>
<li><p>&#x8D8B;&#x52BF;&#x660E;&#x663E;&#x7684;&#x2F8F;&#x60C5;&#x4E2D;&#xFF0C;&#x5F53; ROC &#x5411;&#x4E0B;&#x8DCC;&#x7834;&#x96F6;&#xFF0C;&#x5356;&#x51FA;&#x4FE1;&#x53F7;&#xFF0C;ROC &#x5411;&#x4E0A;&#x7A81;&#x7834;&#x96F6;&#xFF0C;&#x4E70;&#x2F0A;&#x4FE1;&#x53F7;&#xFF1B;&#x9707;&#x8361;&#x2F8F;&#x60C5;&#x4E2D;&#xFF0C;&#x5F53; ROC &#x5411;&#x4E0B;&#x8DCC;&#x7834; MAROC/EMAROC &#x65F6;&#xFF0C;&#x5356;&#x51FA;&#x4FE1;&#x53F7;&#xFF0C;&#x5F53; ROC &#x4E0A;&#x7A7F; MAROC/EMAROC &#x65F6;&#xFF0C;&#x4E70;&#x2F0A;&#x4FE1;&#x53F7;&#x3002;</p>
</li>
</ul>
</li>
<li><p>ADTM</p>
<ul>
<li><p>Definition</p>
<pre><code class="lang-{python}">N = 23
M = 8

DTM = 0 if open &lt; open_yesterday else max( high - open, open - open_yesterday)
DBM = 0 if open &gt; open_yesterday else max( open - low, open - open_yesterday)
STM = sum(DTM, N)
SDM = sum(DBM, N)
ADTM = (STM - SBM) / STM if STM &gt; SBM else (STM - SBM) / SBM
ADTMMA = sum(ADTM, M)
</code></pre>
</li>
<li><p>Theory: ADTM&#x6307;&#x6807;&#x5728;+1&#x5230;-1&#x4E4B;&#x95F4;&#x6CE2;&#x52A8;&#x3002;&#x5DEE;&#x4E8E;-0.5&#x65F6;&#x4E3A;&#x4F4E;&#x98CE;&#x9669;&#x533A;,&#x597D;&#x4E8E;+0.5&#x65F6;&#x4E3A;&#x9AD8;&#x98CE;&#x9669;&#x533A;&#xFF0C;&#x9700;&#x6CE8;&#x610F;&#x98CE;&#x9669;&#x3002;ADTM&#x4E0A;&#x7A7F;ADTMMA&#x65F6;&#xFF0C;&#x8D2D;&#x5165;&#x80A1;&#x7968;&#xFF1B;ADTM&#x8DCC;&#x7A7F;ADTMMA&#x65F6;&#xFF0C;&#x51FA;&#x552E;&#x80A1;&#x7968;&#x3002;</p>
</li>
</ul>
</li>
<li><p>DBCD</p>
<ul>
<li>Definition
<script type="math/tex; mode=display">
    \begin{gathered}
    \mathrm{BIAS}=(\mathrm{CLOSE}-\mathrm{SMA}(\mathrm{CLOSE}, \mathrm{~N} 1)) / \mathrm{SMA}(\mathrm{CLOSE}, \mathrm{~N} 1) \\
    \mathrm{DIF}=\mathrm{BIAS}-\mathrm{BIAS}[\mathrm{~N} 2] \\
    \mathrm{DBCD}=\mathrm{SMA}(\mathrm{DIF}, \mathrm{~N} 3, 1)
    \end{gathered}
    </script>
where N1=5, N2=16, N3=17, and <script type="math/tex; ">[N]</script> is the t-N value if current time is t. 
<script type="math/tex; mode=display">
    SMA(X, m, n):= Y_t = \frac{n}{m} X + \frac{m-n}{m} Y_{t-1}
    </script></li>
</ul>
</li>
<li><p>KDJ</p>
<ul>
<li><p>Definition</p>
<pre><code class="lang-{python}">N = 9
M1 = 3
M2 = 3

RSV = 100 * (close - np.min(low[-N:])) / (np.max(high[-N:]) - np.min(low[-N:])) # highest high and lowest low in the past N days
K = SMA(RSV, M1, 1)
D = SMA(RSV, M2, 1)
J = J = 3*K - 2*D
</code></pre>
</li>
<li><p>Theory: </p>
<ul>
<li>When the K line breaks above the D line on the graph, it is commonly known as the golden cross, which is a signal to buy. </li>
<li>When the K value is diminishing and then breaks below the D line from above, it is commonly called a dead cross and seen as a signal to sell. </li>
<li>When the J value is greater than 90, especially for more than five consecutive days, the stock price will at least form a short-term peak. On the contrary, when the J value is less than 10, especially for several consecutive days, the stock price will at least form a short-term bottom.</li>
</ul>
</li>
<li><p>Thoughts: The main limitation of the KDJ is that it can generate false signals under volatile markets.  We can use idio risk / realized vol / etc. to rescale RSV values for each stock.</p>
</li>
</ul>
</li>
<li><p>ATR</p>
<ul>
<li><p>Definition</p>
<pre><code class="lang-{python}">N = 20

TR = max(high-low, abs(high-close_prev), abs(low-close_prev))
ATR = EMA(TR, N)
</code></pre>
</li>
<li><p>Theory: &#x2F64;&#x4E8E;&#x8868;&#x2F70;&#x4EF7;&#x683C;&#x7684;&#x6CE2;&#x52A8;&#x7A0B;&#x5EA6;&#xFF0C;&#x4EF7;&#x683C;&#x6CE2;&#x52A8;&#x5E45;&#x5EA6;&#x7684;&#x7A81;&#x7834;&#x901A;&#x5E38;&#x4E5F;&#x9884;&#x2F70;&#x7740;&#x4EF7;&#x683C;&#x7684;&#x7A81;&#x7834;&#xFF0C;&#x8BE5;&#x6307;&#x6807;&#x4EF7;&#x503C;&#x8D8A;&#x2FBC;&#xFF0C;&#x8D8B;&#x52BF;&#x6539;&#x53D8;&#x7684;&#x53EF;&#x80FD;&#x6027;&#x5C31;&#x8D8A;&#x2FBC;&#xFF1B;&#x8BE5;&#x62DB;&#x6807;&#x7684;&#x4EF7;&#x5104;&#x8D8A;&#x4F4E;&#xFF0C;&#x8D8B;&#x52BF;&#x7684;&#x79FB;&#x52A8;&#x6027;&#x5C31;&#x8D8A;&#x5F31;&#x3002;</p>
</li>
<li><p>Thoughts: use as indicator.</p>
</li>
</ul>
</li>
<li><p>Chaikin Volatility</p>
<ul>
<li><p>Definition</p>
<pre><code class="lang-{python}">N = 10
M = 10

REM = EMA(high - low, N)
CV = 100* (REM - REM_{t-M}) / REM_{t-M}
</code></pre>
</li>
<li><p>Theory: &#x2F64;&#x4E8E;&#x80A1;&#x4EF7;&#x7684;&#x6CE2;&#x52A8;&#x60C5;&#x51B5;&#xFF1B;&#x2F00;&#x4E2A;&#x76F8;&#x5BF9;&#x8F83;&#x77ED;&#x65F6;&#x95F4;&#x5185;&#x7684;&#x6CE2;&#x52A8;&#x7387;&#x4E0A;&#x5347;&#x610F;&#x5473;&#x7740;&#x5E02;&#x573A;&#x5E95;&#x90E8;&#x7684;&#x5230;&#x6765;&#xFF0C;&#x2F00;&#x6BB5;&#x76F8;&#x5BF9;&#x8F83;&#x957F;&#x65F6;&#x95F4;&#x5185;&#x6CE2;&#x52A8;&#x7387;&#x7684;&#x4E0B;&#x964D;&#x610F;&#x5473;&#x7740;&#x5E02;&#x573A;&#x9876;&#x90E8;&#x7684;&#x6765;&#x5230;&#xFF0C;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x6CE2;&#x52A8;&#x7387;&#x9884;&#x6D4B;&#x80A1;&#x7968;&#x672A;&#x6765;&#x7684;&#x8D8B;&#x52BF;&#x3002;</p>
</li>
<li><p>Thoughts: use as indicator.</p>
</li>
</ul>
</li>
<li><p>BBI</p>
<ul>
<li><p>Definition</p>
<pre><code class="lang-{python}">M1 = 3
M2 = 6
M3 = 12
M4 = 20

BBI = ( MA(close, M1) + MA(close, M2) + MA(close, M3) + MA(close, M4) ) / 4
</code></pre>
</li>
</ul>
</li>
<li><p>Chaikin Oscillator</p>
<ul>
<li><p>Definition</p>
<pre><code class="lang-{python}">X = (2*close - high - low) / (high - low)
ADL = Volume * X
#ADL = ADL + ADL_prev
CO = EMA(ADL, 3) - EMA(ADL, 10)
</code></pre>
</li>
<li><p>Theory:</p>
<ul>
<li>CO is an improvement of ADL (Accumulation/Distribution Line).</li>
<li>Monitor General Money Flow - An ADL&apos;s move higher is a signal that buying pressure is starting to prevail. On the flip side, an ADLs downward move signals increased selling pressure is beginning to gain a foothold.</li>
<li>Confirmation - You can also use the ADL to confirm the strength, and possibly the longevity, of a current move.</li>
</ul>
</li>
</ul>
</li>
<li><p>Mass Index</p>
<ul>
<li><p>Definition:
<script type="math/tex; mode=display">
    \text { Mass Index }= \frac{\text { EMA(High - Low, 9)}}{\text{EMA((EMA(High - Low, 9), 9) }}
    </script></p>
</li>
<li><p>Theory: surges in the mass index can correlate with turning points in the price trend.</p>
</li>
<li><p>Thoughts: use as indicator.</p>
</li>
</ul>
</li>
<li><p>PSY</p>
<ul>
<li><p>Definition
<script type="math/tex; mode=display">
    \text { PSY } = \frac{100 * \operatorname{COUNT}\left(\operatorname{CLOSE}_t > \operatorname{CLOSE}_{t-1}, N\right)}{N}
    </script>
where N = 12.</p>
</li>
<li><p>Theory: PSY &#x5C06;&#x2F00;&#x5B9A;&#x65F6;&#x671F;&#x5185;&#x6295;&#x8D44;&#x8005;&#x8D8B;&#x5411;&#x4E70;&#x2F45;&#x6216;&#x5356;&#x2F45;&#x7684;&#x2F3C;&#x7406;&#x4E8B;&#x5B9E;&#x8F6C;&#x5316;&#x4E3A;&#x6570;&#x503C;&#xFF0C;&#x5F62;&#x6210;&#x2F08;&#x2F53;&#x6307;&#x6570;&#xFF0C;&#x4ECE;&#x2F7D;&#x5224;&#x65AD;&#x80A1;&#x4EF7;&#x7684;&#x672A;&#x6765;&#x8D8B;&#x52BF;&#xFF1B;&#x901A;&#x5E38;&#xFF0C;&#x6307;&#x6807;&#x2F29;&#x4E8E;25&#x65F6;&#x5173;&#x6CE8;&#x505A;&#x591A;&#x673A;&#x4F1A;&#xFF0C;&#x2F24;&#x4E8E;75&#x65F6;&#x5173;&#x6CE8;&#x505A;&#x7A7A;&#x673A;&#x4F1A;&#xFF0C;&#x2F29;&#x4E8E;10&#x4E3A;&#x6781;&#x5EA6;&#x8D85;&#x5356;&#xFF0C;&#x2F24;&#x4E8E;90&#x4E3A;&#x573E;&#x5EA6;&#x8D85;&#x4E70;&#xFF0C;&#x5E02;&#x573A;&#x5BBD;&#x5E45;&#x632F;&#x8361;&#x65F6;&#xFF0C;PSY &#x4E5F;&#x4F1A;25~75&#x533A;&#x95F4;&#x53CD;&#x590D;&#x8207;&#x7834;&#xFF0C;&#x7ED9;&#x51FA;&#x2F46;&#x6548;&#x4FE1;&#x53F7;&#x3002;</p>
</li>
</ul>
</li>
</ul>
<h1 id="high-frequency"><a name="high-frequency" class="anchor-navigation-ex-anchor" href="#high-frequency"><i class="fa fa-link" aria-hidden="true"></i></a> High Frequency</h1>
<ul>
<li><p>&#x6BCF;&#x7B14;&#x6210;&#x4EA4;&#x91CF;&#x5DEE;&#x5206;&#x6807;&#x51C6;&#x5DEE;
<script type="math/tex; mode=display">
  \begin{aligned}
  &\operatorname{diff}_i=\operatorname{volb}_i-\operatorname{volb}_{i-1}\\
  &\operatorname{diff-mean}_{\text {day }}=\operatorname{mean}\left(a b s\left(\frac{\operatorname{diff}_i}{\operatorname{mean}\left(\left\{\operatorname{volb}_i\right\}\right)}\right)\right.\\
  &\text { diff-std }_{\text {volb }}=\text { mean }\left(\left\{\text { diff-std }_{\text {day }}\right\}\right)
  \end{aligned}
  </script>
&#x5176;&#x4E2D;<script type="math/tex; ">v o l b_i</script> &#x4E3A;&#x4E2A;&#x80A1;&#x65E5;&#x5185; 240 &#x6839; 1 &#x5206;&#x949F; K &#x7EBF;&#x7684;&#x6BCF;&#x7B14;&#x6210;&#x4EA4;&#x91CF;&#xFF08;&#x6210;&#x4EA4;&#x91CF;&#xFF0F;&#x6210;&#x4EA4;&#x7B14;&#x6570;&#xFF09;&#xFF0C;diff_stdday&#x53D6;&#x8FC7;&#x53BB; 20 &#x4E2A;&#x4EA4;&#x6613;&#x65E5;&#x6570;&#x636E;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_diff_std_volb</span><span class="hljs-params">(
    da: xr.DataArray,
    half_life: int=<span class="hljs-number">20</span>,
)</span>:</span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (<span class="hljs-string">&quot;locVol&quot;</span>,<span class="hljs-string">&quot;numTrade&quot;</span>):
        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
            <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Missing required variable &apos;{v}&apos; in V1&quot;</span>)

    v_locVol = da.sel(V1=<span class="hljs-string">&quot;locVol&quot;</span>)
    v_numTr  = da.sel(V1=<span class="hljs-string">&quot;numTrade&quot;</span>)

    volb = divide_safe(v_locVol, v_numTr)

    diff_raw = volb.diff(dim=<span class="hljs-string">&quot;E&quot;</span>, label=<span class="hljs-string">&quot;upper&quot;</span>)
    diff_full = diff_raw.reindex(E=volb[<span class="hljs-string">&quot;E&quot;</span>])
    day_mean_volb = volb.mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    day_mean_volb_b = day_mean_volb.broadcast_like(volb)
    norm_abs_diff = (diff_full.abs() / day_mean_volb_b).astype(<span class="hljs-string">&quot;float64&quot;</span>)
    diff_std_day = norm_abs_diff.std(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    <span class="hljs-comment">#diff_std_day = norm_abs_diff.mean(&quot;E&quot;, skipna=True)</span>
    <span class="hljs-comment">#fac_trailing = diff_std_day.rolling(D=half_life, min_periods=1).mean().isel(D=[-1])</span>
    fac_trailing = _ewm_ma_halflife(diff_std_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life).isel(D=[<span class="hljs-number">-1</span>])
    f_b = fac_trailing.broadcast_like(volb.D=[<span class="hljs-number">-1</span>])
    out = xr.concat([f_b], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=[<span class="hljs-string">&quot;factor_diff_std_volb&quot;</span>])
    out = out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
    <span class="hljs-keyword">return</span> out
</code></pre>
</li>
</ul>
<ul>
<li><p>&#x9AD8;&#x9891;&#x4E0A;&#x884C;&#x6CE2;&#x52A8;&#x5360;&#x6BD4;
<script type="math/tex; mode=display">
  \frac{\sum_t\left(r_i^t I_{\left\{r_i^t>0\right\}}\right)^2}{\sum_t\left(r_i^t\right)^2}
  </script></p>
<p>&#x5176;&#x4E2D;
&#xFF08;1&#xFF09;<script type="math/tex; ">r_i^l</script> &#x4E3A;&#x5206;&#x949F;&#x9891;&#x7387;&#x4E0B;&#x7684;&#x80A1;&#x7968;&#x6536;&#x76CA;&#x5E8F;&#x5217;&#xFF0C;&#x5982; 1 &#x5206;&#x949F;&#x3001; 5 &#x5206;&#x949F;&#x3001; 10 &#x5206;&#x949F;&#x7B49;&#xFF1B;
&#xFF08;2&#xFF09;&#x5728;&#x4EFB;&#x610F;&#x9009;&#x80A1;&#x65F6;&#x523B;&#xFF0C;&#x56E0;&#x5B50;&#x503C;&#x4E3A;&#x524D; N &#x65E5;&#x6307;&#x6807;&#x7684;&#x5747;&#x503C;&#xFF0C;&#x5982;&#x6708;&#x5EA6;&#x9009;&#x80A1;&#xFF0C;&#x8BA1;&#x7B97;&#x56E0;&#x5B50;&#x503C;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x80A1;&#x7968;&#x8FC7;&#x53BB; 20 &#x4E2A;&#x4EA4;&#x6613;&#x65E5;&#x7684;&#x5747;&#x503C;&#x3002;</p>
<p>&#x80A1;&#x7968;&#x9AD8;&#x9891;&#x6536;&#x76CA;&#x7684;&#x4E0A;&#x884C;&#x6CE2;&#x52A8;&#x8861;&#x91CF;&#x4E86;&#x80A1;&#x7968;&#x4EF7;&#x683C;&#x62C9;&#x5347;&#x7684;&#x7279;&#x5F81;&#x3002;&#x5047;&#x8BBE;&#x6709;&#x4E24;&#x53EA;&#x80A1;&#x7968;&#x5728;&#x8FC7;&#x53BB;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x6709;&#x7740;&#x76F8;&#x540C;&#x7684;&#x6DA8;&#x5E45;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x53EA;&#x80A1;&#x7968;&#x7684;&#x6DA8;&#x5E45;&#x7531;&#x6301;&#x7EED;&#x7A33;&#x5B9A;&#x7684;&#x5C0F;&#x5E45;&#x4E0A;&#x6DA8;&#x4357;&#x8BA1;&#x5E26;&#x52A8;&#xFF0C;&#x800C;&#x53E6;&#x4E00;&#x53EA;&#x80A1;&#x7968;&#x7684;&#x4E0A;&#x6DA8;&#x6E90;&#x81EA;&#x4E8E;&#x80A1;&#x7968;&#x77ED;&#x671F;&#x7684;&#x5927;&#x5E45;&#x62C9;&#x5347;&#xFF0C;&#x90A3;&#x4E48;&#x540E;&#x8005;&#x66F4;&#x6709;&#x53EF;&#x80FD;&#x5728;&#x6536;&#x76CA;&#x4E0A;&#x51FA;&#x73B0;&#x53CD;&#x8F6C;&#xFF0C;&#x800C;&#x540E;&#x8005;&#x5728;&#x56E0;&#x5B50;&#x503C;&#x4E0A;&#x4E5F;&#x4F1A;&#x4F53;&#x73B0;&#x51FA;&#x8F83;&#x9AD8;&#x7684;&#x4E0A;&#x884C;&#x6CE2;&#x52A8;&#x7387;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_hf_upvol_share</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
    half_life: int = <span class="hljs-number">20</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">if</span> ret_var <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
        <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{ret_var}&apos; not found in V1&quot;</span>)

    ret = da.sel(V1=ret_var)
    num_day = (ret.clip(min=<span class="hljs-number">0</span>) ** <span class="hljs-number">2</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    den_day = (ret ** <span class="hljs-number">2</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    ratio_day = divide_safe(num_day, den_day)
    ratio_ema = _ewm_ma_halflife(ratio_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life)

    ratio_last = ratio_ema.isel(D=[<span class="hljs-number">-1</span>])
    factor_last = ratio_last.broadcast_like(ret.isel(D=[<span class="hljs-number">-1</span>]))

    out_list = [factor_last]

    out = xr.concat(out_list, dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=[<span class="hljs-string">&quot;hf_upvol_share&quot;</span>])
    out = out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>*out
</code></pre>
</li>
</ul>
<ul>
<li>&#x975E;&#x6D41;&#x52A8;&#x6027;&#x7684;&#x53D8;&#x5F02;&#x7CFB;&#x6570;: &#x80A1;&#x7968;&#x7684;&#x975E;&#x6D41;&#x52A8;&#x6027;&#x7684;&#x53D8;&#x5F02;&#x7CFB;&#x6570;&#x8F83;&#x9AD8;&#xFF0C;&#x8BF4;&#x660E;&#x975E;&#x6D41;&#x52A8;&#x6027;&#x7684;&#x6CE2;&#x52A8;&#x8F83;&#x5927;&#xFF0C;&#x5BF9;&#x4E8E;&#x6301;&#x6709;&#x8BE5;&#x7C7B;&#x80A1;&#x7968;&#x7684;&#x6295;&#x8D44;&#x8005;&#x6765;&#x8BF4;&#xFF0C;&#x672A;&#x6765;&#x5356;&#x51FA;&#x8BE5;&#x7C7B;&#x80A1;&#x7968;&#x6709;&#x7740;&#x66F4;&#x9AD8;&#x7684;&#x4EA4;&#x6613;&#x6210;&#x672C;&#x4E0D;&#x786E;&#x5B9A;&#x6027;&#xFF0C;&#x6240;&#x4EE5;&#x7531;&#x6B64;&#x80FD;&#x591F;&#x83B7;&#x5F97;&#x66F4;&#x9AD8;&#x7684;&#x98CE;&#x9669;&#x6EA2;&#x4EF7;&#x3002;</li>
</ul>
<p><script type="math/tex; mode=display">
\begin{aligned}
I L L I Q_{i, t} & =\frac{\left|r_{i, t}\right|}{\text { Amount }_{i, t}} \\
C V I L L I Q_i & =\frac{\sigma\left(I L L I Q_i\right)}{\overline{I L L I Q_i}}
\end{aligned}
</script></p>
<p>&#x5176;&#x4E2D;
&#xFF08;1&#xFF09; Amount <script type="math/tex; ">_{i, t}</script> &#x4E3A;&#x80A1;&#x7968; i &#x5728; t &#x65F6;&#x523B;&#x7684;&#x4EA4;&#x6613;&#x91D1;&#x989D;&#xFF1B;
&#xFF08;2&#xFF09;<script type="math/tex; ">r_{i, t}</script> &#x662F;&#x80A1;&#x7968; i &#x5728; t &#x65F6;&#x523B;&#x6536;&#x76CA;&#x7387;&#xFF1B;
&#xFF08;3&#xFF09;&#x65F6;&#x95F4;&#x7A97;&#x53E3;&#x671F;&#x4E3A;&#x8FC7;&#x53BB; 20 &#x4E2A;&#x4EA4;&#x6613;&#x65E5;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_cv_illiq</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
    vol_var: str = <span class="hljs-string">&quot;locVol&quot;</span>,
    half_life: float = <span class="hljs-number">20</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (ret_var, vol_var):
        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
            <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{v}&apos; not found in V1&quot;</span>)

    ret  = da.sel(V1=ret_var)
    amount   = da.sel(V1=vol_var)
    amount = close * vol
    illiq_min = divide_safe(ret.abs(), amount)
    illiq_day = illiq_min.mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    mu_ewm  = _ewm_ma_halflife(illiq_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&apos;mean&apos;</span>)
    std_ewm = _ewm_ma_halflife(illiq_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&apos;std&apos;</span>)
    cv_series = divide_safe(std_ewm, mu_ewm)

    factor_last = cv_series.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(ret.isel(D=[<span class="hljs-number">-1</span>]))
    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=[<span class="hljs-string">&apos;cv_illiq&apos;</span>])
    out = out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
    <span class="hljs-keyword">return</span> out
</code></pre>
<ul>
<li><p>&#x6210;&#x4EA4;&#x91CF;&#x6CE2;&#x5CF0;&#x8BA1;&#x6570;&#x56E0;&#x5B50;</p>
<ol>
<li><p>&#x8BA1;&#x7B97;&#x5168;&#x90E8; 240 &#x6839; $K$ &#x7EBF;&#x6570;&#x636E;&#x7684;&#x5747;&#x503C;&#x4E0E;&#x6807;&#x51C6;&#x5DEE;&#xFF0C;&#x7B5B;&#x9009;&#x51FA;&#x5927;&#x4E8E;&#xFF08;&#x5747;&#x503C; +1 &#x500D;&#x6807;&#x51C6;&#x5DEE;&#xFF09;&#x7684;&#x5206;&#x949F;&#x6570;&#x636E;&#xFF1B;</p>
</li>
<li><p>&#x8BA1;&#x7B97;&#x4E0A;&#x4E00;&#x6B65;&#x7B5B;&#x9009;&#x51FA;&#x7684;&#x6BCF;&#x4E00;&#x5206;&#x949F;&#x4E0E;&#x524D;&#x4E00;&#x5206;&#x949F;&#x4E4B;&#x95F4;&#x7684;&#x65F6;&#x95F4;&#x5DEE;&#xFF0C;&#x53EA;&#x6709;&#x65F6;&#x95F4;&#x5DEE;&#x8D85;&#x8FC7; 1 &#x5206;&#x949F;&#xFF08;&#x5373;&#x76F8;&#x9694;&#x8D85;&#x8FC7; 1 &#x6839; $K$ &#x7EBF;&#xFF09;&#x65F6;&#xFF0C;&#x8BE5;&#x5206;&#x949F;&#x6570;&#x636E;&#x624D;&#x4F1A;&#x88AB;&#x4FDD;&#x7559;&#xFF1B;</p>
</li>
<li><p>&#x7ECF;&#x8FC7;&#x4E0A;&#x8FF0;&#x4E24;&#x6B65;&#x7B5B;&#x9009;&#x540E;&#xFF0C;&#x5269;&#x4F59;&#x7684;&#x6570;&#x636E;&#x5168;&#x90E8;&#x88AB;&#x89C6;&#x4F5C;&#x5C40;&#x90E8;&#x5CF0;&#x503C;&#xFF0C;&#x5CF0;&#x503C;&#x4E2A;&#x6570;&#x5373;&#x4E3A;&#x5F53;&#x65E5;&#x6210;&#x4EA4;&#x91CF;&#x6CE2;&#x5CF0;&#x8BA1;&#x6570;&#x56E0;&#x5B50;&#x7684;&#x53D6;&#x503C;&#xFF0C;&#x800C;&#x6700;&#x7EC8;&#x8C03;&#x4ED3;&#x65E5;&#x7684;&#x56E0;&#x5B50;&#x503C;&#x4ECD;&#x4E3A;&#x8FC7;&#x53BB; 20 &#x4E2A;&#x4EA4;&#x6613;&#x65E5;&#x56E0;&#x5B50;&#x503C;&#x7684;&#x5747;&#x503C;&#x3002;</p>
</li>
<li><p>&#x51FA;&#x73B0;&#x65E5;&#x5185;&#xFF02;&#x653E;&#x91CF;&#xFF02;&#x73B0;&#x8C61;&#x6B21;&#x6570;&#x66F4;&#x591A;&#x7684;&#x80A1;&#x7968;&#x53EF;&#x80FD;&#x6709;&#x66F4;&#x591A;&#x7684;&#x8D8B;&#x52BF;&#x6216;&#x77E5;&#x60C5;&#x4EA4;&#x6613;&#x8005;&#x53C2;&#x4E0E;&#x4EA4;&#x6613;&#xFF0C;&#x8FDB;&#x800C;&#x5728;&#x672A;&#x6765;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x6709;&#x66F4;&#x9AD8;&#x7684;&#x6536;&#x76CA;&#x7387;&#xFF0C;&#x56E0;&#x5B50;&#x4E0E;&#x672A;&#x6765;&#x6536;&#x76CA;&#x6B63;&#x76F8;&#x5173;&#x3002;</p>
</li>
</ol>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_vol_spike_count</span><span class="hljs-params">(
    da: xr.DataArray,
    vol_var: str = <span class="hljs-string">&quot;volume&quot;</span>,
    k_std: float = <span class="hljs-number">1.0</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">if</span> vol_var <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
        <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{vol_var}&apos; not found in V1&quot;</span>)

    vol = da.sel(V1=vol_var)

    day_mean = vol.mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)                  <span class="hljs-comment"># S x D</span>
    day_std  = vol.std(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)                   <span class="hljs-comment"># S x D</span>
    thr = (day_mean + k_std * day_std).broadcast_like(vol) <span class="hljs-comment"># S x D x E</span>

    flagged = (vol &gt; thr).fillna(<span class="hljs-keyword">False</span>)                    <span class="hljs-comment"># bool S x D x E</span>

    prev_flagged = flagged.shift(E=<span class="hljs-number">1</span>, fill_value=<span class="hljs-keyword">False</span>)
    keep = flagged &amp; (~prev_flagged)                       <span class="hljs-comment"># bool S x D x E</span>

    count_day = keep.sum(<span class="hljs-string">&quot;E&quot;</span>).astype(<span class="hljs-string">&quot;float64&quot;</span>)            <span class="hljs-comment"># S x D</span>
    count_ema = _ewm_ma_halflife(count_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)  <span class="hljs-comment"># S x D</span>

    factor_last = count_ema.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(vol.isel(D=[<span class="hljs-number">-1</span>]))       <span class="hljs-comment"># S x 1 x E</span>

    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=[vol_spike_count])
    out = out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
    <span class="hljs-keyword">return</span> out
</code></pre>
<ul>
<li><p>&#x4EF7;&#x683C;&#x51B2;&#x51FB;&#x504F;&#x5DEE;:</p>
<ul>
<li><p>MoneyFlow
<script type="math/tex; mode=display">
    MF_t = \frac{(locVolBuy_t - locVolSell_t)}{locVol_t}
    </script></p>
</li>
<li><p>&#x4E0A;&#x6DA8;/&#x4E0B;&#x8DCC;&#x7528;&#x5206;&#x949F;&#x6536;&#x76CA; ret &#x7684;&#x7B26;&#x53F7;&#x5224;&#x5B9A;&#xFF1A;<script type="math/tex; ">I_t=\mathbf{1}_{\{ret_t\ge0\}}</script>&#x3002;</p>
</li>
<li><p>&#x5728;&#x65E5;&#x5185;&#x7528;&#x96F6;&#x622A;&#x8DDD;&#x56DE;&#x5F52;&#x7684;&#x89E3;&#x6790;&#x5F0F;&#x4F30;&#x8BA1;&#x4E24;&#x6761;&#x659C;&#x7387;&#xFF1A;
<script type="math/tex; mode=display">
    \gamma^{up}=\frac{\sum_{I_t=1} MF_t\cdot ret_t}{\sum_{I_t=1} MF_t^2},\quad \gamma^{down}=\frac{\sum_{I_t=0} MF_t\cdot ret_t}{\sum_{I_t=0} MF_t^2}
    </script></p>
</li>
</ul>
</li>
</ul>
<pre><code>&#x56E0;&#x4E3A;&#x4E24;&#x7EC4;&#x4E92;&#x65A5;&#xFF0C;&#x7B49;&#x4EF7;&#x4E8E;&#x56DE;&#x5F52; ret_t=\gamma^{up}(I_t MF_t)+\gamma^{down}((1-I_t)MF_t) &#x65E0;&#x622A;&#x8DDD;&#x3002;
</code></pre><ul>
<li><p>&#x65E5;&#x5EA6;&#x504F;&#x5DEE;&#xFF1A;
<script type="math/tex; mode=display">
    \text{bias}_{day}=\frac{\gamma^{up}-\gamma^{down}}{\gamma^{up}+\gamma^{down}}
    </script></p>
</li>
<li><p>&#x518D;&#x53D6;&#x5747;&#x503C;&#x6216;&#x8005;EMA</p>
</li>
<li><p>&#x4EF7;&#x683C;&#x51B2;&#x51FB;&#x504F;&#x5DEE;&#x4E3B;&#x8981;&#x8868;&#x5F81;&#x4E86;&#x80A1;&#x7968;&#x5728;&#x67D0;&#x4E00;&#x65F6;&#x95F4;&#x533A;&#x95F4;&#x4E0A;&#x6DA8;&#x6216;&#x8005;&#x4E0B;&#x8DCC;&#x7684;&#x96BE;&#x6613;&#x7A0B;&#x5EA6;&#xFF0C;&#x4EF7;&#x683C;&#x51B2;&#x51FB;&#x504F;&#x5DEE;&#x8F83;&#x5927;&#xFF08;&#x6B63;&#x503C;&#xFF09;&#x7684;&#x80A1;&#x7968;&#xFF0C;&#x76F8;&#x540C;&#x6BD4;&#x4F8B;&#x7684;&#x4E3B;&#x52A8;&#x8BA2;&#x5355;&#x5BF9;&#x5176;&#x80A1;&#x4EF7;&#x5411;&#x4E0B;&#x7684;&#x51B2;&#x51FB;&#x5C0F;&#x4E8E;&#x5411;&#x4E0A;&#x7684;&#x51B2;&#x51FB;&#xFF0C;&#x80A1;&#x7968;&#x5BB9;&#x6613;&#x4E0A;&#x6DA8;&#xFF0C;&#x53CD;&#x4E4B;&#xFF0C;&#x80A1;&#x7968;&#x5BB9;&#x6613;&#x4E0B;&#x8DCC;&#x3002;</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_price_impact_bias</span><span class="hljs-params">(
  da: xr.DataArray,
  ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
  buy_var: str = <span class="hljs-string">&quot;locVolBuy&quot;</span>,
  sell_var: str = <span class="hljs-string">&quot;locVolSell&quot;</span>,
  amount_var: str = <span class="hljs-string">&quot;locVol&quot;</span>,
  half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
  <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (ret_var, <span class="hljs-string">&quot;locVolBuy&quot;</span>, <span class="hljs-string">&quot;locVolSell&quot;</span>, <span class="hljs-string">&quot;locVol&quot;</span>):
      <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
          <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{v}&apos; not found in V1&quot;</span>)

  ret   = da.sel(V1=ret_var)
  buy   = da.sel(V1=<span class="hljs-string">&quot;locVolBuy&quot;</span>)
  sell  = da.sel(V1=<span class="hljs-string">&quot;locVolSell&quot;</span>)
  amount = da.sel(V1=<span class="hljs-string">&quot;locVol&quot;</span>)

  moneyflow = buy - sell
  mf = divide_safe(moneyflow, amount)

  valid = xr.ufuncs.isfinite(mf) &amp; xr.ufuncs.isfinite(ret)
  mf = xr.where(valid, mf, np.nan)
  ret = xr.where(valid, ret, np.nan)

  up_mask   = ret &gt;= <span class="hljs-number">0</span>
  down_mask = ~up_mask

  mf_up   = xr.where(up_mask, mf, np.nan)
  mf_down = xr.where(down_mask, mf, np.nan)

  num_up  = (mf_up * ret).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)          <span class="hljs-comment"># S x D</span>
  den_up  = (mf_up ** <span class="hljs-number">2</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)           <span class="hljs-comment"># S x D</span>
  gamma_up = divide_safe(num_up, den_up)                 <span class="hljs-comment"># S x D</span>

  num_dn  = (mf_down * ret).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
  den_dn  = (mf_down ** <span class="hljs-number">2</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
  gamma_down = divide_safe(num_dn, den_dn)               <span class="hljs-comment"># S x D</span>

  bias_day = divide_safe(gamma_up - gamma_down, gamma_up + gamma_down)  <span class="hljs-comment"># S x D</span>
  bias_ema = _ewm_ma_halflife(bias_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)  <span class="hljs-comment"># S x D</span>

  factor_last = bias_ema.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(ret.isel(D=[<span class="hljs-number">-1</span>]))  <span class="hljs-comment"># S x 1 x E</span>

  out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([<span class="hljs-string">&quot;price_impact_bias&quot;</span>]))
  out = out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
  <span class="hljs-keyword">return</span> out
</code></pre>
</li>
</ul>
<ul>
<li><p>&#x91CF;&#x4EF7;&#x76F8;&#x5173;&#x6027;</p>
<ul>
<li>PV&#xFF3F;corr&#xFF3F;std &#x4ECE;&#x4EF7;&#x91CF;&#x5F62;&#x6001;&#x7A33;&#x5B9A;&#x6027;&#x7684;&#x89D2;&#x5EA6;&#xFF0C;&#x5BF9;&#x53CD;&#x8F6C;&#x56E0;&#x5B50;&#x8FDB;&#x884C;&#x4E86;&#x6539;&#x8FDB;&#xFF0C;&#x5373;&#x65E0;&#x8BBA;&#x80A1;&#x7968;&#x4EF7;&#x683C;&#x8FC7;&#x53BB;&#x7684;&#x6DA8;&#x8DCC;&#xFF0C;&#x53EA;&#x8981;&#x6BCF;&#x65E5;&#x4EF7;&#x91CF;&#x5173;&#x7CFB;&#x7EF4;&#x6301;&#x67D0;&#x79CD;&#x7A33;&#x5B9A;&#x5F62;&#x6001;&#xFF0C;&#x4E0B;&#x4E2A;&#x6708;&#x5C31;&#x66F4;&#x6709;&#x53EF;&#x80FD;&#x4E0A;&#x6DA8;&#xFF1B;&#x800C;&#x4EF7;&#x91CF;&#x5173;&#x7CFB;&#x5728;&#x591A;&#x79CD;&#x5F62;&#x6001;&#x95F4; &#x9891;&#x7E41;&#x5207;&#x6362;&#x7684;&#x80A1;&#x7968;&#xFF0C;&#x4E0B;&#x4E2A;&#x6708;&#x66F4;&#x6709;&#x53EF;&#x80FD;&#x4E0B;&#x8DCC;&#x3002;</li>
<li>PV&#xFF3F;corr&#xFF3F;avg &#x5229;&#x7528;&#x6210;&#x4EA4;&#x91CF;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4FEE;&#x6B63;&#x4E86;&#x4F20;&#x7EDF;&#x53CD;&#x8F6C;&#x56E0;&#x5B50;&#x5BF9;&#x80A1;&#x7968;&#x4EF7;&#x683C;&#x6DA8;&#x8DCC;&#x7684;&#x5224;&#x65AD;&#xFF0C;&#x5373;&#x4EF7;&#x683C;&#x6DA8;&#x8DCC;&#x7684;&#x53CD;&#x8F6C;&#x4E0D;&#x5B8C;&#x5168;&#x7531;&#x4EF7;&#x683C;&#x81EA;&#x5DF1;&#x51B3;&#x5B9A;&#xFF0C;&#x8FD8;&#x9700;&#x770B;&#x6210;&#x4EA4;&#x91CF;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x82E5;&#x6709;&#x91CF;&#x7684;&#x786E;&#x8BA4;&#xFF0C;&#x5219;&#x6708;&#x5EA6;&#x884C;&#x60C5;&#x7684;&#x53CD;&#x8F6C;&#x6548;&#x5E94;&#x66F4;&#x5F3A;&#xFF1B;&#x82E5;&#x6CA1;&#x6709;&#x91CF;&#x7684;&#x786E;&#x8BA4;&#xFF0C;&#x5219;&#x6708;&#x5EA6;&#x884C;&#x60C5;&#x66F4;&#x5BB9;&#x6613;&#x5448;&#x73B0;&#x52A8;&#x91CF;&#x6548;&#x5E94;&#x3002;</li>
<li>&#x4EF7;&#x91CF;&#x76F8;&#x5173;&#x6027;&#x8D8B;&#x52BF;&#x56E0;&#x5B50;: &#x5728;&#x8DE8;&#x65E5;&#x7EF4;&#x5EA6;&#x4E0A;&#xFF0C;&#x7528;&#x6307;&#x6570;&#x52A0;&#x6743;&#x7684;&#x7EBF;&#x6027;&#x56DE;&#x5F52;&#x53D6;&#x659C;&#x7387;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_pv_corr_family</span><span class="hljs-params">(
    da: xr.DataArray,
    price_var: str = <span class="hljs-string">&quot;robust&quot;</span>,
    vol_var: str = <span class="hljs-string">&quot;locVol&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
    mode: str = <span class="hljs-string">&quot;avg&quot;</span>,   # <span class="hljs-string">&apos;avg&apos;</span> | <span class="hljs-string">&apos;std&apos;</span> | <span class="hljs-string">&apos;trend&apos;</span>
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-comment">## todo: mean condi ret</span>
    <span class="hljs-keyword">if</span> mode <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;avg&quot;</span>, <span class="hljs-string">&quot;std&quot;</span>, <span class="hljs-string">&quot;trend&quot;</span>}:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;mode must be one of {&apos;avg&apos;,&apos;std&apos;,&apos;trend&apos;}&quot;</span>)
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (price_var, vol_var):
        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
            <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{v}&apos; not found in V1&quot;</span>)

    price = da.sel(V1=price_var)  <span class="hljs-comment"># S x D x E</span>
    vol   = da.sel(V1=vol_var)    <span class="hljs-comment"># S x D x E</span>

    p_mean = price.mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    v_mean = vol.mean(<span class="hljs-string">&quot;E&quot;</span>,   skipna=<span class="hljs-keyword">True</span>)
    p_dm   = price - p_mean
    v_dm   = vol   - v_mean
    p_std  = price.std(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    v_std  = vol.std(<span class="hljs-string">&quot;E&quot;</span>,   skipna=<span class="hljs-keyword">True</span>)

    z_p = divide_safe(p_dm, p_std)
    z_v = divide_safe(v_dm, v_std)
    corr_day = (z_p * z_v).mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)  <span class="hljs-comment"># S x D</span>

    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">&quot;avg&quot;</span>:
        fac_series = _ewm_ma_halflife(corr_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)  <span class="hljs-comment"># S x D</span>
        out_name = <span class="hljs-string">&quot;pv_corr_avg&quot;</span>

    <span class="hljs-keyword">elif</span> mode == <span class="hljs-string">&quot;std&quot;</span>:
        fac_series = <span class="hljs-number">-1</span>*_ewm_ma_halflife(corr_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;std&quot;</span>)   <span class="hljs-comment"># S x D</span>
        out_name = <span class="hljs-string">&quot;pv_corr_std&quot;</span>

    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># mode == &apos;trend&apos;</span>
        nD = corr_day.sizes[<span class="hljs-string">&quot;D&quot;</span>]
        ages = xr.DataArray(np.arange(nD)[::<span class="hljs-number">-1</span>], dims=[<span class="hljs-string">&quot;D&quot;</span>], coords={<span class="hljs-string">&quot;D&quot;</span>: corr_day[<span class="hljs-string">&quot;D&quot;</span>]}).astype(<span class="hljs-string">&quot;float64&quot;</span>)
        w = (<span class="hljs-number">0.5</span> ** (ages / float(half_life))).astype(<span class="hljs-string">&quot;float64&quot;</span>)   <span class="hljs-comment"># D</span>
        wB = w.broadcast_like(corr_day)                            <span class="hljs-comment"># S x D</span>

        x = xr.DataArray(np.arange(nD), dims=[<span class="hljs-string">&quot;D&quot;</span>], coords={<span class="hljs-string">&quot;D&quot;</span>: corr_day[<span class="hljs-string">&quot;D&quot;</span>]}).astype(<span class="hljs-string">&quot;float64&quot;</span>)
        xB = x.broadcast_like(corr_day)                            <span class="hljs-comment"># S x D</span>

        wsum = w.sum(<span class="hljs-string">&quot;D&quot;</span>, skipna=<span class="hljs-keyword">True</span>)                             <span class="hljs-comment"># scalar</span>
        xbar = (w * x).sum(<span class="hljs-string">&quot;D&quot;</span>, skipna=<span class="hljs-keyword">True</span>) / wsum                <span class="hljs-comment"># scalar</span>
        x_center = xB - xbar                                       <span class="hljs-comment"># S x D (broadcasted)</span>

        y = corr_day                                               <span class="hljs-comment"># S x D</span>
        ybar = (wB * y).sum(<span class="hljs-string">&quot;D&quot;</span>, skipna=<span class="hljs-keyword">True</span>) / wsum               <span class="hljs-comment"># S</span>
        y_center = y - ybar.broadcast_like(y)                      <span class="hljs-comment"># S x D</span>

        num = (wB * x_center * y_center).sum(<span class="hljs-string">&quot;D&quot;</span>, skipna=<span class="hljs-keyword">True</span>)     <span class="hljs-comment"># S</span>
        den = (wB * x_center * x_center).sum(<span class="hljs-string">&quot;D&quot;</span>, skipna=<span class="hljs-keyword">True</span>)     <span class="hljs-comment"># S</span>
        fac_series = <span class="hljs-number">-1</span>*divide_safe(num, den).expand_dims(D=[da[<span class="hljs-string">&quot;D&quot;</span>].values[<span class="hljs-number">-1</span>]])  <span class="hljs-comment"># S x 1 (treat as a day)</span>
        out_name = <span class="hljs-string">&quot;pv_corr_trend&quot;</span>

    factor_last = fac_series.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(vol.isel(D=[<span class="hljs-number">-1</span>]))  <span class="hljs-comment"># S x 1 x E</span>
    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([out_name]))
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
</ul>
<ul>
<li>&#x4E0A;&#x4E0B;&#x884C;&#x6CE2;&#x52A8;&#x7387;&#x4E0D;&#x5BF9;&#x79F0;&#x6027;: &#x5BF9;&#x6BCF;&#x4E2A;&#x4EA4;&#x6613;&#x65E5;&#xFF0C;&#x628A;&#x5206;&#x949F;&#x6536;&#x76CA;&#x5E73;&#x65B9;&#x5E76;&#x5206;&#x65B9;&#x5411;&#x7D2F;&#x52A0;&#x3002;&#x6700;&#x540E;&#x518D;&#x53D6;d&#x65E5;&#x5E73;&#x5747;&#x3002;<ul>
<li>RSJ &#x8861;&#x91CF;&#x4E86;&#x4E0A;&#x4E0B;&#x884C;&#x6CE2;&#x52A8;&#x7684;&#x4E0D;&#x5BF9;&#x79F0;&#x6027;&#xFF1B;RSJ &#x901A;&#x5E38;&#x6709;&#x8D1F;&#x98CE;&#x9669;&#x6EA2;&#x4EF7;&#xFF0C;&#x77ED;&#x671F;&#x65E5;&#x5185;&#x7684;&#x60C5;&#x7EEA;&#x4E0D;&#x7A33;&#x5B9A;&#x7684;&#x5927;&#x5E45;&#x4E0A;&#x6DA8;&#x5F80;&#x5F80;&#x8DDF;&#x7740;&#x672A;&#x6765;&#x7684;&#x8865;&#x8DCC;&#xFF08;RSJ &#x8D8A;&#x5927;&#xFF09;&#xFF0C;&#x77ED;&#x671F;&#x65E5;&#x5185;&#x60C5;&#x7EEA;&#x4E0D;&#x7A33;&#x5B9A;&#x7684;&#x5927;&#x5E45;&#x4E0B;&#x8DCC;&#x4E5F;&#x5F80;&#x5F80;&#x8DDF;&#x7740;&#x672A;&#x6765;&#x7684;&#x8865;&#x6DA8;&#x3002;</li>
</ul>
</li>
</ul>
<p><script type="math/tex; mode=display">
RV_d=\sum r_{d,i}^2,\quad RV^{up}d=\sum r{d,i}^2\mathbf{1}{\{r{d,i}>0\}},\quad RV^{down}d=\sum r{d,i}^2\mathbf{1}{\{r{d,i}<0\}} \\
RSJ_d = \frac{RV^{up}_d - RV^{down}_d}{RV_d}
</script></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_rsj_asymmetry</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">if</span> ret_var <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
        <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{ret_var}&apos; not found in V1&quot;</span>)

    r = da.sel(V1=ret_var)                          <span class="hljs-comment"># S x D x E</span>
    r2 = r * r
    rv_all  = r2.sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)              <span class="hljs-comment"># S x D</span>
    rv_up   = xr.where(r &gt; <span class="hljs-number">0</span>, r2, <span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)   <span class="hljs-comment"># S x D</span>
    rv_down = xr.where(r &lt; <span class="hljs-number">0</span>, r2, <span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)   <span class="hljs-comment"># S x D</span>

    rsj_day = divide_safe(rv_up - rv_down, rv_all)  <span class="hljs-comment"># S x D</span>
    rsj_ema = _ewm_ma_halflife(rsj_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)  <span class="hljs-comment"># S x D</span>

    factor_last = rsj_ema.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(r.isel(D=[<span class="hljs-number">-1</span>]))  <span class="hljs-comment"># S x 1 x E</span>
    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([<span class="hljs-string">&quot;rsj_asym&quot;</span>]))
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>*out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
<ul>
<li>&#x6A21;&#x7CCA;&#x91D1;&#x989D;&#x6BD4;<ul>
<li>&#x6A21;&#x7CCA;&#x5B9A;&#x4E49;&#xFF1A;5 &#x5206;&#x949F;&#x6EDA;&#x52A8;&#x6CE2;&#x52A8;&#x7387;&#x7684;5 &#x5206;&#x949F;&#x6EDA;&#x52A8;&#x6807;&#x51C6;&#x5DEE;&#x3002;</li>
<li>&#x6A21;&#x7CCA;&#x91D1;&#x989D;&#x6BD4;&#xFF1A;&#x6A21;&#x7CCA;&#x503C;&#x5927;&#x4E8E;&#x65E5;&#x5747;&#x6A21;&#x7CCA;&#x503C;&#x671F;&#x95F4;&#x7684;&#x6210;&#x4EA4;&#x91CF;&#x5360;&#x5F53;&#x65E5;&#x6210;&#x4EA4;&#x91CF;&#x6BD4;&#x503C;&#xFF0C;&#x518D;&#x53D6;d&#x65E5;&#x5E73;&#x5747;&#x3002;</li>
<li>&#x56E0;&#x5B50;&#x4ECE;&#x91D1;&#x989D;&#x7EF4;&#x5EA6;&#x7EDF;&#x8BA1;&#x4E86;&#x6295;&#x8D44;&#x8005;&#x5728;&#x6A21;&#x7CCA;&#x6027;&#x8F83;&#x5927;&#x65F6;&#x7684;&#x6210;&#x4EA4;&#x7A0B;&#x5EA6;&#xFF0C;&#x540C;&#x6837;&#x8861;&#x91CF;&#x4E86;&#x6295;&#x8D44;&#x8005;&#x5BF9;&#x6A21;&#x7CCA;&#x6027;&#x7684;&#x538C;&#x6076;&#x7A0B;&#x5EA6;&#xFF0C;&#x4E0E;&#x672A;&#x6765;&#x6536;&#x76CA;&#x8D1F;&#x76F8;&#x5173;&#xFF1B;&#x6295;&#x8D44;&#x8005;&#x5BF9;&#x6CE2;&#x52A8;&#x7387;&#x6A21;&#x7CCA;&#x6027;&#x7684;&#x538C;&#x6076;&#x5FC3;&#x7406;&#x4F1A;&#x4F7F;&#x5F97;&#x6295;&#x8D44;&#x8005;&#x6025;&#x4E8E;&#x5356;&#x51FA;&#x800C;&#x4EA7;&#x751F;&#x8FC7;&#x5EA6;&#x53CD;&#x5E94;&#xFF0C;&#x672A;&#x6765;&#x5F88;&#x53EF;&#x80FD;&#x4F1A;&#x8865;&#x6DA8;&#x3002;</li>
<li>&#x53EF;&#x4EE5;&#x7528;&#x6210;&#x4EA4;&#x91D1;&#x989D;&#x4E5F;&#x53EF;&#x4EE5;&#x7528;&#x6210;&#x4EA4;&#x91CF;</li>
</ul>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_ambiguity_amount_ratio</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
    mode: str = <span class="hljs-string">&quot;amount&quot;</span>,         # <span class="hljs-string">&apos;amount&apos;</span> | <span class="hljs-string">&apos;volume&apos;</span> | <span class="hljs-string">&apos;spread&apos;</span>
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">if</span> mode <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;amount&quot;</span>, <span class="hljs-string">&quot;volume&quot;</span>, <span class="hljs-string">&quot;spread&quot;</span>}:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;mode must be one of {&apos;amount&apos;,&apos;volume&apos;,&apos;spread&apos;}&quot;</span>)
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (ret_var, <span class="hljs-string">&quot;locVol&quot;</span>, <span class="hljs-string">&quot;volume&quot;</span>):
        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
            <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{v}&apos; not found in V1&quot;</span>)

    r   = da.sel(V1=ret_var)        <span class="hljs-comment"># S x D x E</span>
    amt = da.sel(V1=<span class="hljs-string">&quot;locVol&quot;</span>)     <span class="hljs-comment"># S x D x E  (Amount &#x2261; locVol)</span>
    vol = da.sel(V1=<span class="hljs-string">&quot;volume&quot;</span>)    <span class="hljs-comment"># S x D x E  (Quantity)</span>

    sigma = r.rolling(E=<span class="hljs-number">5</span>, min_periods=<span class="hljs-number">5</span>).std()
    amb   = sigma.rolling(E=<span class="hljs-number">5</span>, min_periods=<span class="hljs-number">5</span>).std()

    amb_day_mean = amb.mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>).broadcast_like(amb)
    fog = amb &gt; amb_day_mean

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_daily_ratio</span><span class="hljs-params">(x: xr.DataArray)</span> -&gt; xr.DataArray:</span>
        fog_mean = x.where(fog).mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)  <span class="hljs-comment"># S x D</span>
        all_mean = x.mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)             <span class="hljs-comment"># S x D</span>
        <span class="hljs-keyword">return</span> divide_safe(fog_mean, all_mean)          <span class="hljs-comment"># S x D</span>

    <span class="hljs-keyword">if</span> mode <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;amount&quot;</span>, <span class="hljs-string">&quot;spread&quot;</span>}:
        ratio_amt_day = _daily_ratio(amt)               <span class="hljs-comment"># S x D</span>
    <span class="hljs-keyword">if</span> mode <span class="hljs-keyword">in</span> {<span class="hljs-string">&quot;volume&quot;</span>, <span class="hljs-string">&quot;spread&quot;</span>}:
        ratio_vol_day = _daily_ratio(vol)              <span class="hljs-comment"># S x D</span>

    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">&quot;amount&quot;</span>:
        series_day = ratio_amt_day
        fac_name = <span class="hljs-string">&quot;amb_amount_ratio&quot;</span>
    <span class="hljs-keyword">elif</span> mode == <span class="hljs-string">&quot;volume&quot;</span>:
        series_day = ratio_vol_day
        fac_name = <span class="hljs-string">&quot;amb_volume_ratio&quot;</span>
    <span class="hljs-keyword">else</span>:
        spread_day = ratio_amt_day - ratio_vol_day      <span class="hljs-comment"># S x D</span>
        std10 = spread_day.rolling(D=half_life, min_periods=<span class="hljs-number">1</span>).std()  <span class="hljs-comment"># S x D</span>
        neg_mask = spread_day &lt; <span class="hljs-number">0</span>
        adjusted = xr.where(neg_mask, divide_safe(spread_day, std10), spread_day)  <span class="hljs-comment"># S x D</span>

        s1 = spread_day.where(spread_day &lt; <span class="hljs-number">0</span>).fillna(<span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)   <span class="hljs-comment"># D</span>
        s2 = adjusted.where(adjusted &lt; <span class="hljs-number">0</span>).fillna(<span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)       <span class="hljs-comment"># D</span>
        scale = divide_safe(s1, s2)                                               <span class="hljs-comment"># D</span>
        scaleB = scale.broadcast_like(adjusted)                                   <span class="hljs-comment"># S x D</span>
        adjusted = xr.where(adjusted &lt; <span class="hljs-number">0</span>, adjusted * scaleB, adjusted)            <span class="hljs-comment"># S x D</span>
        series_day = adjusted
        fac_name = <span class="hljs-string">&quot;amb_price_spread_adj&quot;</span>

    ema_mean = _ewm_ma_halflife(series_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)  <span class="hljs-comment"># S x D</span>
    factor_last = ema_mean.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(vol.isel(D=[<span class="hljs-number">-1</span>]))  <span class="hljs-comment"># S x 1 x E</span>
    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([fac_name]))
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>*out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
<ul>
<li><p>&#x65F6;&#x95F4;&#x52A0;&#x6743;&#x5E73;&#x5747;&#x7684;&#x80A1;&#x7968;&#x76F8;&#x5BF9;&#x4EF7;&#x683C;&#x4F4D;&#x7F6E;: &#x8861;&#x91CF;&#x80A1;&#x7968;&#x5728;&#x4EF7;&#x683C;&#x76F8;&#x5BF9;&#x9AD8;&#x4F4D;&#x505C;&#x7559;&#x7684;&#x65F6;&#x95F4;&#x957F;&#x77ED;&#xFF0C;&#x80A1;&#x7968;&#x5728;&#x4EF7;&#x683C;&#x76F8;&#x5BF9;&#x9AD8;&#x4F4D;&#x505C;&#x7559;&#x7684;&#x65F6;&#x95F4;&#x8D8A;&#x957F;&#xFF0C;&#x56E0;&#x5B50;&#x53D6;&#x503C;&#x8D8A;&#x5927;&#x3002;
<script type="math/tex; mode=display">
  \mathrm{ARPP}=\frac{1}{T}\int_0^T \mathrm{RPP}_t\,dt =\frac{\left(\frac{1}{T}\int_0^T P_t\,dt\right)-L}{H-L} =\frac{\mathrm{TWAP}-L}{H-L}
  </script></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_arpp</span><span class="hljs-params">(
    da: xr.DataArray,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (<span class="hljs-string">&quot;robust&quot;</span>, <span class="hljs-string">&quot;high&quot;</span>, <span class="hljs-string">&quot;low&quot;</span>):
        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
            <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{v}&apos; not found in V1&quot;</span>)

    price = da.sel(V1=<span class="hljs-string">&quot;robust&quot;</span>)
    high  = da.sel(V1=<span class="hljs-string">&quot;high&quot;</span>)
    low   = da.sel(V1=<span class="hljs-string">&quot;low&quot;</span>)

    twap_day = price.mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    high_day = high.max(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    low_day  = low.min(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)

    denom = high_day - low_day
    arpp_day = divide_safe(twap_day - low_day, denom)
    arpp_day = xr.where(np.isfinite(arpp_day), arpp_day.clip(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>), np.nan)
    arpp_ema = _ewm_ma_halflife(arpp_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)
    factor_last = arpp_ema.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(price.isel(D=[<span class="hljs-number">-1</span>]))
    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([<span class="hljs-string">&quot;arpp&quot;</span>]))
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
</ul>
<ul>
<li><p>&#x975E;&#x6D41;&#x52A8;&#x6027;&#xFF1A;</p>
<ul>
<li>&#x5206;&#x949F;&#x7EA7;&#x201C;&#x6700;&#x77ED;&#x8DEF;&#x5F84;&#x201D;</li>
</ul>
<p><script type="math/tex; mode=display">
  \mathrm{shortcut}_t=2(\mathrm{high}_t-\mathrm{low}_t)-|\,\mathrm{close}_t-\mathrm{open}_t\,| .
  </script></p>
<ul>
<li>&#x5F53;&#x65E5;&#x975E;&#x6D41;&#x52A8;&#x6027;&#xFF0C;&#x518D;&#x53D6;d&#x65E5;&#x5E73;&#x5747;</li>
</ul>
<p><script type="math/tex; mode=display">
  \mathrm{ILLIQ}{\text{day}}=\sum{t\in\text{day}} \frac{\mathrm{shortcut}_t}{\mathrm{Amount}t}.
  </script></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_illiq_shortcut</span><span class="hljs-params">(
    da: xr.DataArray,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (<span class="hljs-string">&quot;open&quot;</span>, <span class="hljs-string">&quot;robust&quot;</span>, <span class="hljs-string">&quot;high&quot;</span>, <span class="hljs-string">&quot;low&quot;</span>, <span class="hljs-string">&quot;locVol&quot;</span>):
        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
            <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{v}&apos; not found in V1&quot;</span>)

    o = da.sel(V1=<span class="hljs-string">&quot;open&quot;</span>)       <span class="hljs-comment"># S x D x E</span>
    c = da.sel(V1=<span class="hljs-string">&quot;robust&quot;</span>)
    h = da.sel(V1=<span class="hljs-string">&quot;high&quot;</span>)
    l = da.sel(V1=<span class="hljs-string">&quot;low&quot;</span>)
    amt = da.sel(V1=<span class="hljs-string">&quot;locVol&quot;</span>)   <span class="hljs-comment"># S x D x E</span>

    shortcut = <span class="hljs-number">2.0</span> * (h - l) - (c - o).abs()                       <span class="hljs-comment"># S x D x E</span>
    ratio = divide_safe(shortcut, amt)                              <span class="hljs-comment"># S x D x E</span>
    illiq_day = ratio.sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)                         <span class="hljs-comment"># S x D</span>
    illiq_ema = _ewm_ma_halflife(illiq_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)  <span class="hljs-comment"># S x D</span>
    factor_last = illiq_ema.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(c.isel(D=[<span class="hljs-number">-1</span>]))  <span class="hljs-comment"># S x 1 x E</span>

    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([<span class="hljs-string">&quot;illiq_shortcut&quot;</span>]))
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
</ul>
<ul>
<li><p>&#x8D1F;&#x504F;&#x5EA6;&#x7CFB;&#x6570;&#xFF1A;&#x8D1F;&#x504F;&#x5EA6;&#x7CFB;&#x6570;&#x9AD8;&#x7684;&#x80A1;&#x7968;&#x6709;&#x7740;&#x66F4;&#x9AD8;&#x7684;&#x66B4;&#x8DCC;&#x53EF;&#x80FD;&#xFF0C;&#x4E5F;&#x5C31;&#x6709;&#x7740;&#x671F;&#x671B;&#x66F4;&#x9AD8;&#x7684;&#x98CE;&#x9669;&#x6EA2;&#x4EF7;&#x3002;</p>
<p><script type="math/tex; mode=display">
  N C S K E W_i=\frac{-(n(n-1))^{1.5} \sum\left(r_{i t}-\bar{r}_l\right)^3}{(n-1)(n-2)\left(\sum\left(r_{i t}-\bar{r}_l\right)^2\right)^{1.5}}
  </script></p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_ncskew</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">if</span> ret_var <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
        <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{ret_var}&apos; not found in V1&quot;</span>)

    r_min = da.sel(V1=ret_var)                         <span class="hljs-comment"># S x D x E</span>
    r_day = (<span class="hljs-number">1.0</span> + r_min).prod(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>) - <span class="hljs-number">1.0</span> <span class="hljs-comment"># S x D</span>

    mu = _ewm_ma_halflife(r_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)  <span class="hljs-comment"># S x D</span>
    sigma = _ewm_ma_halflife(r_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;std&quot;</span>)<span class="hljs-comment"># S x D</span>

    c = r_day - mu
    m3_ewm = _ewm_ma_halflife(c**<span class="hljs-number">3</span>, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)  <span class="hljs-comment"># S x D</span>

    denom = sigma ** <span class="hljs-number">3</span>
    ncs = - divide_safe(m3_ewm, denom)                 <span class="hljs-comment"># S x D</span>

    factor_last = ncs.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(r_min.isel(D=[<span class="hljs-number">-1</span>]))  <span class="hljs-comment"># S x 1 x E</span>
    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([<span class="hljs-string">&quot;ncskew_ewm&quot;</span>]))
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
</ul>
<ul>
<li><p>&#x4EF7;&#x683C;&#x81EA;&#x76F8;&#x5173;&#x6027;&#x56E0;&#x5B50;:</p>
<ul>
<li>&#x4EF7;&#x683C;&#x4E00;&#x9636;&#x5DEE;&#x5206;&#x5E8F;&#x5217; (ret &#x5E8F;&#x5217;)&#xFF0C;&#x53D6;&#x6B63;&#x7684;&#x90E8;&#x5206;&#x505A;&#x4E00;&#x9636;&#x81EA;&#x76F8;&#x5173;&#xFF0C;&#x8D1F;&#x7684;&#x90E8;&#x5206;&#x4E5F;&#x505A;&#x4E00;&#x9636;&#x81EA;&#x76F8;&#x5173;&#xFF0C;&#x7136;&#x540E;&#x5408;&#x5E76;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_cdpp</span><span class="hljs-params">(
    da: xr.DataArray,
    price_var: str = <span class="hljs-string">&quot;robust&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;robust&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
        <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{&quot;</span>robust<span class="hljs-string">&quot;}&apos; not found in V1&quot;</span>)

    p = da.sel(V1=<span class="hljs-string">&quot;robust&quot;</span>)
    dP = p.diff(<span class="hljs-string">&quot;E&quot;</span>)
    dP = dP.reindex(E=p[<span class="hljs-string">&quot;E&quot;</span>])
    dP_lead = dP.shift(E=<span class="hljs-number">-1</span>)
    pos = dP &gt; <span class="hljs-number">0</span>
    neg = dP &lt; <span class="hljs-number">0</span>

    dP_pos = xr.where(pos, dP, np.nan)
    dP_lead_pos = xr.where(pos, dP_lead, np.nan)
    corr_pos_day = xr.corr(dP_pos, dP_lead_pos, dim=<span class="hljs-string">&quot;E&quot;</span>)   <span class="hljs-comment"># S x D</span>

    dP_neg = xr.where(neg, dP, np.nan)
    dP_lead_neg = xr.where(neg, dP_lead, np.nan)
    corr_neg_day = xr.corr(dP_neg, dP_lead_neg, dim=<span class="hljs-string">&quot;E&quot;</span>)   <span class="hljs-comment"># S x D</span>

    ema_pos = _ewm_ma_halflife(corr_pos_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)
    ema_neg = _ewm_ma_halflife(corr_neg_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)

    mu_p = ema_pos.isel(D=<span class="hljs-number">-1</span>).mean(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    sd_p = ema_pos.isel(D=<span class="hljs-number">-1</span>).std(<span class="hljs-string">&quot;S&quot;</span>,  skipna=<span class="hljs-keyword">True</span>)
    z_p = divide_safe(ema_pos.isel(D=<span class="hljs-number">-1</span>) - mu_p, sd_p)

    mu_n = ema_neg.isel(D=<span class="hljs-number">-1</span>).mean(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    sd_n = ema_neg.isel(D=<span class="hljs-number">-1</span>).std(<span class="hljs-string">&quot;S&quot;</span>,  skipna=<span class="hljs-keyword">True</span>)
    z_n = divide_safe(ema_neg.isel(D=<span class="hljs-number">-1</span>) - mu_n, sd_n)

    combined = <span class="hljs-number">0.5</span> * (z_p + z_n)                       <span class="hljs-comment"># S</span>
    series_last = combined.expand_dims(D=[da[<span class="hljs-string">&quot;D&quot;</span>].values[<span class="hljs-number">-1</span>]])  <span class="hljs-comment"># S x 1</span>

    factor_last = series_last.broadcast_like(p.isel(D=[<span class="hljs-number">-1</span>]))    <span class="hljs-comment"># S x 1 x E</span>
    out = xr.concat([factor_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([<span class="hljs-string">&quot;cdpp&quot;</span>]))
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
<li><p>&#x6210;&#x4EA4;&#x91CF;&#x5206;&#x5E03;</p>
<ul>
<li>&#x8BA1;&#x7B97;&#x540C;&#x4EF7;&#x6210;&#x4EA4;&#x91CF;&#xFF1A;&#x5C06;&#x65E5;&#x5185;&#x76F8;&#x540C;&#x5206;&#x949F;&#x6536;&#x76D8;&#x4EF7;&#x7684;&#x6210;&#x4EA4;&#x91CF;&#x7D2F;&#x52A0;&#x81F3;&#x4E00;&#x8D77;&#xFF0C;&#x5F97;&#x5230;&#x5728;&#x5F53;&#x524D;&#x4EF7;&#x683C;&#x4E0A;&#x7684;&#x6210;&#x4EA4;&#x91CF;&#x603B;&#x548C;&#xFF1B;</li>
<li>&#x5C06;&#x6210;&#x4EA4;&#x91CF;&#x7D2F;&#x8BA1;&#x6700;&#x5927;&#x7684;&#x4EF7;&#x683C;&#x5B9A;&#x4E49;&#x4E3A;&#x8BE5;&#x80A1;&#x5F53;&#x65E5;&#x7684;&#x6210;&#x4EA4;&#x91CF;&#x652F;&#x6491;&#x70B9; Volume Support Price&#xFF0C;&#x5305;&#x542B;&#x8BE5;&#x652F;&#x6491;&#x70B9;&#x7684;&#x9644;&#x8FD1;&#x533A;&#x57DF;&#x5B9A;&#x4E49;&#x4E3A;&#x6210;&#x4EA4;&#x91CF;&#x652F;&#x6491;&#x533A;&#x57DF; Volume Support Area&#xFF1B;</li>
<li>&#x9010;&#x6B65;&#x8BA1;&#x7B97; VSP &#x5468;&#x56F4;&#x7684;&#x6210;&#x4EA4;&#x91CF;&#x7D2F;&#x8BA1;&#x503C;&#xFF08;&#x4EF7;&#x683C;&#x7531;&#x8FD1;&#x53CA;&#x8FDC;&#xFF0C;&#x6210;&#x4EA4;&#x91CF;&#x7531;&#x5927;&#x53CA;&#x5C0F;&#xFF09;&#xFF0C;&#x8BE5;&#x7D2F;&#x8BA1;&#x503C;&#x4E0E;&#x5168;&#x5929;&#x6210;&#x4EA4;&#x91CF;&#x603B;&#x548C;&#x7684;&#x6BD4;&#x503C;&#x8D85; 50 \% &#x7684;&#x6700;&#x5C0F;&#x533A;&#x57DF;&#xFF0C;&#x5373;&#x4E3A;&#x6210;&#x4EA4;&#x91CF;&#x652F;&#x6491;&#x533A;&#x57DF;VSA&#xFF0C;&#x8BE5;&#x533A;&#x57DF;&#x4E0A;&#x9650;&#x4EF7;&#x683C;&#x4E3A;VSA_High&#xFF0C;&#x4E0B;&#x9650;&#x4EF7;&#x683C;&#x4E3A;VSA_Low&#xFF1B;</li>
<li>VSA_High, VSA_Low &#x53EF;&#x4EE5;&#x5206;&#x522B;&#x4E0E;&#x5F53;&#x65E5;&#x6700;&#x9AD8;&#x4EF7;&#x3001;&#x6700;&#x4F4E;&#x4EF7;&#x3001;&#x6536;&#x76D8;&#x4EF7;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#x5F97;&#x5230;&#x4E0D;&#x540C;feature</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_volume_support_pb</span><span class="hljs-params">(
    da: xr.DataArray,
    half_life: float = <span class="hljs-number">10.0</span>,
    mode: str = <span class="hljs-string">&quot;b&quot;</span>
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> (<span class="hljs-string">&quot;robust&quot;</span>, <span class="hljs-string">&quot;volume&quot;</span>, <span class="hljs-string">&quot;high&quot;</span>, <span class="hljs-string">&quot;low&quot;</span>):
        <span class="hljs-keyword">if</span> v <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
            <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{v}&apos; not found in V1&quot;</span>)

    price = da.sel(V1=<span class="hljs-string">&quot;robust&quot;</span>)  <span class="hljs-comment"># S x D x E</span>
    vol   = da.sel(V1=<span class="hljs-string">&quot;volume&quot;</span>) <span class="hljs-comment"># S x D x E</span>
    high  = da.sel(V1=<span class="hljs-string">&quot;high&quot;</span>)   <span class="hljs-comment"># S x D x E</span>
    low   = da.sel(V1=<span class="hljs-string">&quot;low&quot;</span>)    <span class="hljs-comment"># S x D x E</span>

    high_day = high.max(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)   <span class="hljs-comment"># S x D</span>
    low_day  = low.min(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)    <span class="hljs-comment"># S x D</span>
    close_day  = price.isel(E=<span class="hljs-number">-1</span>)    <span class="hljs-comment"># S x D</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_vsa_bounds_1d</span><span class="hljs-params">(p_arr: np.ndarray, v_arr: np.ndarray)</span>:</span>
        mask = np.isfinite(p_arr) &amp; np.isfinite(v_arr) &amp; (v_arr &gt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">if</span> mask.sum() == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> np.nan, np.nan
        df = pd.DataFrame({<span class="hljs-string">&quot;p&quot;</span>: p_arr[mask], <span class="hljs-string">&quot;v&quot;</span>: v_arr[mask]})
        agg = df.groupby(<span class="hljs-string">&quot;p&quot;</span>, sort=<span class="hljs-keyword">True</span>)[<span class="hljs-string">&quot;v&quot;</span>].sum()
        total = float(agg.sum())
        <span class="hljs-keyword">if</span> total &lt;= <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> np.nan, np.nan

        vmax = agg.max()
        vsp = agg[agg == vmax].index.values.mean()

        uniq_prices = agg.index.values
        vols = agg.values
        dist = np.abs(uniq_prices - vsp)
        order = np.lexsort((-vols, dist))

        cum = <span class="hljs-number">0.0</span>
        sel = np.zeros_like(order, dtype=bool)
        <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> order:
            sel[idx] = <span class="hljs-keyword">True</span>
            cum += vols[idx]
            <span class="hljs-keyword">if</span> cum &gt;= <span class="hljs-number">0.5</span> * total:
                <span class="hljs-keyword">break</span>
        chosen_prices = uniq_prices[sel]
        <span class="hljs-keyword">return</span> float(chosen_prices.min()), float(chosen_prices.max())

    vsa_low, vsa_high = xr.apply_ufunc(
        _vsa_bounds_1d,
        price, vol,
        input_core_dims=[[<span class="hljs-string">&quot;E&quot;</span>], [<span class="hljs-string">&quot;E&quot;</span>]],
        output_core_dims=[[], []],
        vectorize=<span class="hljs-keyword">True</span>,
        dask=<span class="hljs-string">&quot;parallelized&quot;</span>,
        output_dtypes=[np.float64, np.float64],
    )

    <span class="hljs-keyword">if</span> mode == <span class="hljs-string">&quot;p&quot;</span>:
        vsa_low2max_day  = divide_safe(high_day - vsa_low, high_day)
        vsa_ema = _ewm_ma_halflife(vsa_low2max_day,  dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)
        out_name = <span class="hljs-string">&quot;vsa_p_low2max&quot;</span>
    <span class="hljs-keyword">elif</span> mode == <span class="hljs-string">&quot;b&quot;</span>:
        vsa_high2min_day = divide_safe(vsa_high - low_day, low_day)
        vsa_ema = _ewm_ma_halflife(vsa_high2min_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)
        out_name = <span class="hljs-string">&quot;vsa_b_high2min&quot;</span>
    <span class="hljs-keyword">elif</span> mode == <span class="hljs-string">&apos;r&apos;</span>:
        vsa_high2min_day = divide_safe(vsa_low - close_day, close_day)
        vsa_ema = _ewm_ma_halflife(vsa_high2min_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)
        out_name =

    f_last = vsa_ema.isel(D=[<span class="hljs-number">-1</span>]).broadcast_like(vol.isel(D=[<span class="hljs-number">-1</span>]))  <span class="hljs-comment"># S x 1 x E</span>

    out = xr.concat([f_last], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=[out_name])
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
<li><p>&#x8DF3;&#x8DC3;&#x6CE2;&#x52A8;&#x7387;</p>
<ul>
<li><p>&#x65E5;&#x5185;1&#x5206;&#x949F;/5&#x5206;&#x949F;&#x6536;&#x76CA;&#x7387;&#x5E8F;&#x5217;</p>
</li>
<li><p>&#x6B63;/&#x8D1F;&#x534A;&#x65B9;&#x5DEE; realized semivariance)
<script type="math/tex; mode=display">
    RS_t^+ \;=\; \sum_{i=1}^{n_t} r_{t,i}^2\,\mathbf{1}{\{r_{t,i}>0\}}, \qquad RS_t^- \;=\; \sum_{i=1}^{n_t} r_{t,i}^2\,\mathbf{1}{\{r_{t,i}<0\}}.
    </script></p>
</li>
<li><p>&#x4E09;&#x4E58;&#x5E42;&#x53D8;&#x5DEE;&#xFF08;Tripower Variation, &#x8DF3;&#x8DC3;&#x7A33;&#x5065;&#x7684;&#x5DF2;&#x5B9E;&#x73B0;&#x65B9;&#x5DEE;&#xFF09;&#xFF1A;
<script type="math/tex; mode=display">
    \widehat{IV}t \;=\; \mu{2/3}^{-3}\sum_{i=3}^{n_t} \big|r_{t,i}\big|^{2/3}\big|r_{t,i-1}\big|^{2/3}\big|r_{t,i-2}\big|^{2/3}, \\ \mu_q \;=\; \mathbb{E}|Z|^q = \frac{2^{q/2}}{\sqrt{\pi}}\Gamma\!\Big(\tfrac{1+q}{2}\Big),\; Z\sim\mathcal N(0,1).
    </script></p>
</li>
<li><p>&#x4E0A;/&#x4E0B;&#x884C;&#x8DF3;&#x8DC3;&#x6CE2;&#x52A8;&#x7387;</p>
</li>
</ul>
<p><script type="math/tex; mode=display">
  \,RVJP_t \;=\; \max\!\Big(RS_t^+ - \tfrac12 \widehat{IV}_t,\; 0\Big), \\RVJN_t \;=\; \max\!\Big(RS_t^- - \tfrac12 \widehat{IV}_t,\; 0\Big)
  </script></p>
<ul>
<li>&#x4E0A;&#x4E0B;&#x884C;&#x8DF3;&#x8DC3;&#x4E0D;&#x5BF9;&#x79F0;&#x6027;</li>
</ul>
<p><script type="math/tex; mode=display">
  SRVJ_t \;=\; RVJP_t - RVJN_t
  </script></p>
<ul>
<li>&#x5927;/&#x5C0F;&#x8DF3;&#x5206;&#x89E3;&#x7684;&#x9608;&#x503C;</li>
</ul>
<p><script type="math/tex; mode=display">
  \,\gamma_t \;=\; \alpha\,\Delta_n^{0.49}\sqrt{\widehat{IV}_t}\,, \; \Delta_n \;=\; \frac{1}{n_t},\;\; \alpha \approx 4.
  </script></p>
</li>
</ul>
<ul>
<li><p>&#x201C;&#x5927;&#x7684;&#x201D;&#x4E0A;/&#x4E0B;&#x884C;&#x8DF3;&#x8DC3;&#x6CE2;&#x52A8;&#x7387;</p>
<p><script type="math/tex; mode=display">
  \,RVLJP_{\gamma,t} \;=\; \min\!\Big(RVJP_t,\;\sum_{i=1}^{n_t} r_{t,i}^2\mathbf{1}{\{r{t,i}>\gamma_t\}}\Big)\,\\
  
  \,RVLJN_{\gamma,t} \;=\; \min\!\Big(RVJN_t,\;\sum_{i=1}^{n_t} r_{t,i}^2\mathbf{1}{\{r{t,i}<-\gamma_t\}}\Big)\,
  </script></p>
</li>
<li><p>&#x201C;&#x5C0F;&#x7684;&#x201D;&#x4E0A;/&#x4E0B;&#x884C;&#x8DF3;&#x8DC3;&#x6CE2;&#x52A8;&#x7387;</p>
<p><script type="math/tex; mode=display">
  \,RVSJP_t \;=\; RVJP_t - RVLJP_{\gamma,t}, \\
  \,RVSJN_t \;=\; RVJN_t - RVLJN_{\gamma,t}\,.
  </script></p>
</li>
<li><p>&#x201C;&#x5927;&#x7684; / &#x5C0F;&#x7684;&#x201D;&#x4E0A;&#x4E0B;&#x884C;&#x8DF3;&#x8DC3;&#x4E0D;&#x5BF9;&#x79F0;&#x6027;
<script type="math/tex; mode=display">
    \,SRVLJ_t \;=\; RVLJP_{\gamma,t} - RVLJN_{\gamma,t}\,,\\
    \,SRVSJ_t \;=\; RVSJP_t - RVSJN_t\,.
    </script></p>
</li>
<li><p>&#x663E;&#x8457;&#x6027;&#x52A0;&#x6743;&#x7684;&#x4E0A;&#x4E0B;&#x884C;&#x8DF3;&#x8DC3;&#x4E0D;&#x5BF9;&#x79F0;&#x6027;&#xFF08;&#x5DE5;&#x7A0B;&#x53CB;&#x597D;&#x7248;&#xFF09;</p>
<ul>
<li><p>&#x8D85;&#x9608;&#x503C;&#x5F3A;&#x5EA6;&#x6743;&#x91CD;&#xFF08;&#x5F53;&#x65E5;&#xFF09;&#xFF1A;
<script type="math/tex; mode=display">
      W_t \;=\; \sum_{i=1}^{n_t}\max\!\Big(\frac{|r_{t,i}|}{\gamma_t}-1,\,0\Big).
      </script></p>
</li>
<li><p>&#x65F6;&#x95F4;&#x52A0;&#x6743;&#x4E0D;&#x5BF9;&#x79F0;&#x6027;&#xFF08;&#x8DE8;&#x65E5;&#x7528; EMA&#xFF0C;&#x534A;&#x8870;&#x671F; half_life&#xFF09;&#xFF1A;
<script type="math/tex; mode=display">
      \,TSRJV \;=\; \frac{\mathrm{EMA}_t\!\big(W_t\cdot SRVJ_t\big)} {\mathrm{EMA}_t\!\big(W_t\big)}\,.
      </script></p>
</li>
</ul>
</li>
<li><p>&#x7EDF;&#x8BA1;&#x68C0;&#x9A8C;&#x6743;&#x91CD;&#xFF08;&#x5982; BNS/Jacod &#x68C0;&#x9A8C;&#x7684;
<script type="math/tex; mode=display">
    W_{t} =\frac{B V_t}{N^{-1} \sqrt{\hat{\Omega}_{S w V}} \Phi_{1-\alpha}^{-1}}\left(1-\frac{R V_t}{S w V_t}\right).
    </script></p>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_mu_abs_normal</span><span class="hljs-params">(q: float)</span> -&gt; float:</span>
    <span class="hljs-string">&quot;&quot;&quot;E|Z|^q for Z~N(0,1) = 2^{q/2} / sqrt(pi) * Gamma((1+q)/2).&quot;&quot;&quot;</span>
    <span class="hljs-keyword">return</span> (<span class="hljs-number">2.0</span> ** (q / <span class="hljs-number">2.0</span>)) / math.sqrt(math.pi) * math.gamma((<span class="hljs-number">1.0</span> + q) / <span class="hljs-number">2.0</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_jump_volatility_family</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
    alpha: float = <span class="hljs-number">4.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-keyword">if</span> ret_var <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> da.coords[<span class="hljs-string">&quot;V1&quot;</span>].values:
        <span class="hljs-keyword">raise</span> ValueError(f<span class="hljs-string">&quot;Variable &apos;{ret_var}&apos; not found in V1&quot;</span>)

    r = da.sel(V1=ret_var)  <span class="hljs-comment"># S x D x E</span>

    rs_plus  = xr.where(r &gt; <span class="hljs-number">0</span>, r*r, <span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)   <span class="hljs-comment"># S x D</span>
    rs_minus = xr.where(r &lt; <span class="hljs-number">0</span>, r*r, <span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)   <span class="hljs-comment"># S x D</span>

    mu23 = _mu_abs_normal(<span class="hljs-number">2.0</span>/<span class="hljs-number">3.0</span>)
    ar = r.abs() ** (<span class="hljs-number">2.0</span>/<span class="hljs-number">3.0</span>)
    tp = (ar * ar.shift(E=<span class="hljs-number">1</span>) * ar.shift(E=<span class="hljs-number">2</span>)).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)  <span class="hljs-comment"># S x D</span>
    iv_hat = tp / (mu23 ** <span class="hljs-number">3</span>)

    rv_all = (r*r).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)                           <span class="hljs-comment"># S x D</span>
    nbar = r.count(<span class="hljs-string">&quot;E&quot;</span>)                                            <span class="hljs-comment"># S x D  (per-day valid bar count)</span>
    delta_n = divide_safe(<span class="hljs-number">1.0</span>, nbar)                               <span class="hljs-comment"># S x D</span>

    rvjp = xr.ufuncs.maximum(rs_plus - <span class="hljs-number">0.5</span> * iv_hat, <span class="hljs-number">0.0</span>)          <span class="hljs-comment"># S x D</span>
    rvjn = xr.ufuncs.maximum(rs_minus - <span class="hljs-number">0.5</span> * iv_hat, <span class="hljs-number">0.0</span>)         <span class="hljs-comment"># S x D</span>
    srvj = rvjp - rvjn                                             <span class="hljs-comment"># S x D</span>

    gamma = alpha * (delta_n ** <span class="hljs-number">0.49</span>) * xr.ufuncs.sqrt(iv_hat)     <span class="hljs-comment"># S x D</span>
    gamma_b = gamma.broadcast_like(r)                               <span class="hljs-comment"># S x D x E</span>

    sum_up_big   = xr.where(r &gt;  gamma_b, r*r, <span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)  <span class="hljs-comment"># S x D</span>
    sum_down_big = xr.where(r &lt; -gamma_b, r*r, <span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)  <span class="hljs-comment"># S x D</span>

    rvljp = xr.ufuncs.minimum(rvjp, sum_up_big)                    <span class="hljs-comment"># S x D</span>
    rvljn = xr.ufuncs.minimum(rvjn, sum_down_big)                  <span class="hljs-comment"># S x D</span>
    rvsjp = rvjp - rvljp                                           <span class="hljs-comment"># S x D</span>
    rvsjn = rvjn - rvljn                                           <span class="hljs-comment"># S x D</span>
    srvlj = rvljp - rvljn                                          <span class="hljs-comment"># S x D</span>
    srvsj = rvsjp - rvsjn                                          <span class="hljs-comment"># S x D</span>

    abs_r = r.abs()
    W = xr.ufuncs.maximum(divide_safe(abs_r, gamma_b) - <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)  <span class="hljs-comment"># S x D</span>
    num_tsrjv = _ewm_ma_halflife(W * srvj, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)    <span class="hljs-comment"># S x D</span>
    den_tsrjv = _ewm_ma_halflife(W,         dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>)   <span class="hljs-comment"># S x D</span>
    tsrjv = divide_safe(num_tsrjv, den_tsrjv)                                            <span class="hljs-comment"># S x D</span>

    series_map = {
        <span class="hljs-string">&quot;rvjp&quot;</span>:  _ewm_ma_halflife(rvjp,  dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;rvjn&quot;</span>:  _ewm_ma_halflife(rvjn,  dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;srvj&quot;</span>:  _ewm_ma_halflife(srvj,  dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;rvljp&quot;</span>: _ewm_ma_halflife(rvljp, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;rvljn&quot;</span>: _ewm_ma_halflife(rvljn, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;rvsjp&quot;</span>: _ewm_ma_halflife(rvsjp, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;rvsjn&quot;</span>: _ewm_ma_halflife(rvsjn, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;srvlj&quot;</span>: _ewm_ma_halflife(srvlj, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;srvsj&quot;</span>: _ewm_ma_halflife(srvsj, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>),
        <span class="hljs-string">&quot;tsrjv&quot;</span>: tsrjv,
    }

    out = xr.concat(list(series_map.values()), dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=list(series_map.keys()))
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>,<span class="hljs-string">&quot;D&quot;</span>,<span class="hljs-string">&quot;E&quot;</span>,<span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
<ul>
<li>&#x5927;&#x6210;&#x4EA4;&#x91CF;&#x91CF;&#x4EF7;&#x76F8;&#x5173;&#x6027;<ul>
<li>&#x4E2A;&#x80A1;&#x5206;&#x949F;&#x6210;&#x4EA4;&#x91CF;&#x524D;1/3&#x7684;&#x5206;&#x949F;&#xFF0C;&#x6210;&#x4EA4;&#x91CF;&#x548C;&#x4EF7;&#x683C;&#x7684;&#x76F8;&#x5173;&#x6027;&#x3002;</li>
<li>&#x5927;&#x6210;&#x4EA4;&#x91CF;&#x66F4;&#x80FD;&#x4EE3;&#x8868;&#x4E3B;&#x529B;&#x884C;&#x4E3A;&#xFF0C;&#x4FE1;&#x606F;&#x66F4;&#x591A;&#x3002;</li>
</ul>
</li>
<li>&#x4FEE;&#x6B63;&#x7684;&#x65E5;&#x5185;&#x548C;&#x9694;&#x591C;&#x53CD;&#x8F6C;<ul>
<li>&#x5206;&#x522B;&#x8BA1;&#x7B97;&#x65E5;&#x5185;&#x548C;&#x9694;&#x591C;&#x6536;&#x76CA;&#x7387;&#xFF0C;&#x5BF9;&#x8FC7;&#x53BB;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x8BA1;&#x7B97;&#x65F6;&#x5E8F; &#x65E5;&#x5185;/&#x9694;&#x591C;&#x6536;&#x76CA;&#x7387;&#x7684;&#x6CE2;&#x52A8;&#x7387; (std)</li>
<li>&#x5BF9;&#x4E8E;&#x6CE2;&#x52A8;&#x7387;&#x8D85;&#x8FC7;&#x6A2A;&#x622A;&#x9762;&#x5747;&#x503C;&#x7684;&#x80A1;&#x7968;&#xFF0C;&#x66F4;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x53CD;&#x8F6C;&#xFF0C;(EMA/MA)&#x6536;&#x76CA;&#x7387;&#x53D6;&#x6B63;&#xFF1B;&#x5BF9;&#x4E8E;&#x53E6;&#x5916;&#x4E00;&#x90E8;&#x5206;&#x4F4E;&#x6CE2;&#x52A8;&#x7387;&#x7684;&#x80A1;&#x7968;&#xFF0C;&#x66F4;&#x5BB9;&#x6613;&#x51FA;&#x73B0;&#x52A8;&#x91CF;&#xFF0C;(EMA/MA)&#x6536;&#x76CA;&#x7387;&#x53D6;&#x8D1F;&#x3002;</li>
</ul>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_corrected_reversal_both_from_ret</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;mret&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>

    r = da.sel(V1=ret_var)
    r_on = r.isel(E=<span class="hljs-number">0</span>)
    r_intra = r.isel(E=slice(<span class="hljs-number">1</span>, <span class="hljs-keyword">None</span>)).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)

    r_intra_ema = _ewm_ma_halflife(r_intra, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    sig_intra   = _ewm_ma_halflife(r_intra, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;std&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    sig_intra_cs_mean = sig_intra.mean(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)

    f_intra = xr.where(sig_intra &gt;= sig_intra_cs_mean, r_intra_ema, -r_intra_ema)

    r_on_cs_mean_series = r_on.mean(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    d_on = (r_on - r_on_cs_mean_series).abs()

    d_on_ema = _ewm_ma_halflife(d_on, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    sig_on   = _ewm_ma_halflife(d_on, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;std&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    sig_on_cs_mean = sig_on.mean(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)

    f_on = xr.where(sig_on &gt;= sig_on_cs_mean, d_on_ema, -d_on_ema)

    name1 = f<span class="hljs-string">&quot;rev_intra_corr_hl{half_life}&quot;</span>
    name2 = f<span class="hljs-string">&quot;rev_overnight_corr_hl{half_life}&quot;</span>
    out = xr.concat([f_intra, f_on], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=np.array([name1, name2]))
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
<ul>
<li>&#x4EF7;&#x683C;&#x3001;&#x6210;&#x4EA4;&#x91CF;&#x5E8F;&#x5217;&#x5DEE;&#x5206;&#x81EA;&#x76F8;&#x5173;<ul>
<li>&#x4EF7;&#x683C;&#x53CC;&#x5E8F;&#x5217;&#x5DEE;&#x5206;&#x81EA;&#x76F8;&#x5173;<ul>
<li>&#x5148;&#x5BF9;&#x65E5;&#x5185;&#x6536;&#x76D8;&#x4EF7;&#x6309;&#x5206;&#x949F;&#x505A;&#x4E00;&#x9636;&#x5DEE;&#x5206;&#xFF1A;<script type="math/tex; ">\Delta P_t=P_t-P_{t-1}</script></li>
<li>&#x53EA;&#x5728; &#x540C;&#x5411; &#x60C5;&#x51B5;&#x8BA1;&#x7B97;&#x81EA;&#x76F8;&#x5173;&#x7CFB;&#x6570;&#xFF1A;<script type="math/tex; ">\Delta P_t>0\ \&\ \Delta P_{t+1}>0</script> &#x4E0E; <script type="math/tex; ">\Delta P_t<0\ \&\ \Delta P_{t+1}<0</script>&#x3002;</li>
</ul>
</li>
<li>&#x6210;&#x4EA4;&#x91CF;&#x53CC;&#x5E8F;&#x5217;&#x5DEE;&#x5206;&#x81EA;&#x76F8;&#x5173;: <ul>
<li>&#x4EF7;&#x683C;&#x6362;&#x6210;&#x6210;&#x4EA4;&#x91CF;</li>
</ul>
</li>
<li>&#x6210;&#x4EA4;&#x91CF;&#x5355;&#x5E8F;&#x5217;&#x5DEE;&#x5206;<ul>
<li>&#x5728; <script type="math/tex; ">\Delta V_t>0,  \Delta V_t<0</script> &#x4E24;&#x4E2A;&#x5B50;&#x6837;&#x672C;&#x4E0A;&#x5206;&#x522B;&#x7B97;&#x76F8;&#x5173;&#x5E76;&#x505A; EMA</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_selfcorr_price_volume_family</span><span class="hljs-params">(
    da: xr.DataArray,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    price = da.sel(V1=<span class="hljs-string">&quot;robust&quot;</span>)
    vol   = da.sel(V1=<span class="hljs-string">&quot;volume&quot;</span>)

    dP = price.diff(<span class="hljs-string">&quot;E&quot;</span>)
    dP1 = dP.shift(E=<span class="hljs-number">-1</span>)
    dV = vol.diff(<span class="hljs-string">&quot;E&quot;</span>)
    dV1 = dV.shift(E=<span class="hljs-number">-1</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_corr_mask</span><span class="hljs-params">(x, y, mask)</span>:</span>
        <span class="hljs-keyword">return</span> xr.corr(xr.where(mask, x, np.nan), xr.where(mask, y, np.nan), dim=<span class="hljs-string">&quot;E&quot;</span>)

    corr_pp = _corr_mask(dP, dP1, (dP &gt; <span class="hljs-number">0</span>) &amp; (dP1 &gt; <span class="hljs-number">0</span>))
    corr_nn = _corr_mask(dP, dP1, (dP &lt; <span class="hljs-number">0</span>) &amp; (dP1 &lt; <span class="hljs-number">0</span>))
    ema_pp  = _ewm_ma_halflife(corr_pp, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    ema_nn  = _ewm_ma_halflife(corr_nn, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    cdpddp  = <span class="hljs-number">0.5</span> * (xs_zw(ema_pp) + xs_zw(ema_nn))

    corr_v_pos = _corr_mask(dV, dV1, dV &gt; <span class="hljs-number">0</span>)
    corr_v_neg = _corr_mask(dV, dV1, dV &lt; <span class="hljs-number">0</span>)
    ema_v_pos  = _ewm_ma_halflife(corr_v_pos, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    ema_v_neg  = _ewm_ma_halflife(corr_v_neg, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    cdvv       = <span class="hljs-number">0.5</span> * (xs_zw(ema_v_pos) + xs_zw(ema_v_neg))

    corr_v_pp = _corr_mask(dV, dV1, (dV &gt; <span class="hljs-number">0</span>) &amp; (dV1 &gt; <span class="hljs-number">0</span>))
    corr_v_nn = _corr_mask(dV, dV1, (dV &lt; <span class="hljs-number">0</span>) &amp; (dV1 &lt; <span class="hljs-number">0</span>))
    ema_v_nn  = _ewm_ma_halflife(corr_v_nn, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    ema_v_pp  = _ewm_ma_halflife(corr_v_pp, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    cdvdv     = <span class="hljs-number">0.5</span> * (xs_zw(ema_v_pp) + xs_zw(ema_v_nn))

    names = [ f<span class="hljs-string">&quot;cdpddp_hl{half_life}&quot;</span>, f<span class="hljs-string">&quot;cdvv_hl{half_life}&quot;</span>,  f<span class="hljs-string">&quot;cdvdv_hl{half_life}&quot;</span>]
    out = xr.concat([cdpddp, cdvv, cdvdv], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=names)
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
<ul>
<li>&#x4E00;&#x81F4;&#x4E70;&#x5165;/&#x4E00;&#x81F4;&#x5356;&#x51FA;<ul>
<li>&#x5B9A;&#x4E49;&#x5B9E;&#x4F53;/&#x4E00;&#x81F4;&#x6027; &#x5206;&#x949F; K &#x7EBF;&#x7528;&#xFF1A;abs(close - open) &gt;= alpha * (high - low). <script type="math/tex; ">\alpha</script> &#x4E3A;&#x4E00;&#x81F4;&#x53C2;&#x6570;&#xFF0C;<script type="math/tex; ">\alpha</script> &#x8D8A;&#x5927;&#xFF0C; K &#x7EBF;&#x4E00;&#x81F4;&#x6027;&#x8D8A;&#x5F3A;&#xFF08;&#x4E0A;&#x4E0B;&#x5F15;&#x7EBF;&#x8D8A;&#x77ED;&#xFF0C; K &#x7EBF;&#x8D8A;&#x5B9E;&#x4F53;&#xFF09;&#xFF1B;</li>
<li>&#x5F53;&#x65E5;&#x4E00;&#x81F4;&#x4E70;&#x5165;&#x91CF;= &#x6240;&#x6709;&#x201C;&#x4E0A;&#x6DA8;&#x4E14;&#x5B9E;&#x4F53;&#x201D;5m K &#x7EBF;&#x7684;&#x6210;&#x4EA4;&#x91CF;&#x4E4B;&#x548C;&#xFF1B;&#x4E00;&#x81F4;&#x5356;&#x51FA;&#x91CF;= &#x201C;&#x4E0B;&#x8DCC;&#x4E14;&#x5B9E;&#x4F53;&#x201D;&#x7684;&#x6210;&#x4EA4;&#x91CF;&#x4E4B;&#x548C;&#x3002;</li>
<li>&#x56E0;&#x5B50;&#x4E3A;&#x201C;&#x4E00;&#x81F4;&#x91CF; / &#x5F53;&#x65E5;&#x603B;&#x91CF;&#x201D;&#x7684;&#x8DE8;&#x65E5; EMA &#x5747;&#x503C;</li>
</ul>
</li>
</ul>
<pre><code class="lang-{python}">def compute_consist_trd(
    da: xr.DataArray,
    alpha: float = 0.6,
    half_life: float = 10.0,
) -&gt; xr.DataArray:
    c = da.sel(V1=&quot;robust&quot;)
    o = da.sel(V1=&quot;open&quot;)
    h = da.sel(V1=&quot;high&quot;)
    l = da.sel(V1=&quot;low&quot;)
    v = da.sel(V1=&quot;volume&quot;)

    rng = (h - l).clip(min=0.0)
    body = np.abs(c - o)
    solid = (body &gt;= (alpha * rng))

    up_solid_vol   = v.where(solid &amp; (c &gt; o)).sum(&quot;E&quot;, skipna=True)
    down_solid_vol = v.where(solid &amp; (c &lt; o)).sum(&quot;E&quot;, skipna=True)
    total_vol      = v.sum(&quot;E&quot;, skipna=True)

    pcv_day = divide_safe(up_solid_vol, total_vol)
    ncv_day = divide_safe(down_solid_vol, total_vol)

    pcv = _ewm_ma_halflife(pcv_day, dim=&quot;D&quot;, half_life=half_life, mode=&quot;mean&quot;).isel(D=[-1])
    ncv = _ewm_ma_halflife(ncv_day, dim=&quot;D&quot;, half_life=half_life, mode=&quot;mean&quot;).isel(D=[-1])

    out = xr.concat([pcv, ncv], dim=&quot;V1&quot;).assign_coords(V1=[f&quot;pcv_hl{half_life}&quot;, f&quot;ncv_hl{half_life}&quot;])
    return out.transpose(&quot;S&quot;, &quot;D&quot;, &quot;V1&quot;)
</code></pre>
<ul>
<li><p>&#x4E70;&#x5165;&#x5356;&#x51FA;&#x5360;&#x6BD4;</p>
<ul>
<li><p>HCVOL&#xFF08;&#x4E70;&#x5165;&#x201C;&#x6D6E;&#x4E8F;&#x201D;&#x5360;&#x6BD4;&#xFF09;&#x201C;&#x6709;&#x591A;&#x5C11;&#x4E70;&#x5355;&#x662F;&#x5728;&#x9AD8;&#x4E8E;&#x6536;&#x76D8;&#x4EF7;&#x7684;&#x4EF7;&#x4F4D;&#x6210;&#x4EA4;&#x7684;&#xFF1F;&#x201D;</p>
<p>&#x76F4;&#x89C9;&#xFF1A;&#x6536;&#x76D8;&#x524D;&#x8FFD;&#x9AD8;&#x4E70;&#x5165;&#x8D8A;&#x591A;&#xFF0C;&#x9694;&#x65E5;&#x66F4;&#x5BB9;&#x6613;&#x627F;&#x538B;/&#x56DE;&#x843D;&#xFF1B;&#x4F46;&#x4E5F;&#x53EF;&#x89E3;&#x8BFB;&#x4E3A;&#x5F3A;&#x52BF;&#x5438;&#x7B79;&#x3002;
<script type="math/tex; mode=display">
    \text{HCVOL}t \;=\; \frac{\sum_e volumeBuy_{t,e}\,\mathbf 1\{p_{t,e}>Close_t\}} {\sum_e volume_{t,e}}
    </script></p>
</li>
<li><p>HCP&#xFF08;&#x4E70;&#x5165;&#x201C;&#x6D6E;&#x4E8F;&#x201D;&#x4EF7;&#x5DEE;&#xFF09;&#x201C;&#x90A3;&#x4E9B;&#x9AD8;&#x4E8E;&#x6536;&#x76D8;&#x6210;&#x4EA4;&#x7684;&#x4E70;&#x5355;&#xFF0C;&#x5E73;&#x5747;&#x6210;&#x4EA4;&#x4EF7;&#x6BD4;&#x6536;&#x76D8;&#x4EF7;&#x8D35;&#x4E86;&#x591A;&#x5C11;&#xFF1F;&#x201D;</p>
<p>&#x76F4;&#x89C9;&#xFF1A;&#x8D8A;&#x8D35;&#x7684;&#x201C;&#x9AD8;&#x4F4D;&#x4E70;&#x5165;&#x201D;&#xFF0C;&#x7B2C;&#x4E8C;&#x5929;&#x56DE;&#x64A4;&#x98CE;&#x9669;&#x8D8A;&#x5927;&#xFF08;&#x884C;&#x4E3A;&#x91D1;&#x878D;&#x91CC;&#x7684;&#x201C;&#x8FFD;&#x6DA8;-&#x540E;&#x6094;&#x201D;&#x673A;&#x5236;&#xFF09;&#x3002;
<script type="math/tex; mode=display">
    \overline{P}^{\text{buy}\,>\,Close}_t =\frac{\sum_e p_{t,e} volumeBuy_{t,e}\,\mathbf 1\{p_{t,e}>Close_t\}} {\sum_e volumeBuy_{t,e}\,\mathbf 1\{p_{t,e}>Close_t\}},\\ \text{HCP}_t = \frac{\overline{P}^{\text{buy}\,>\,Close}_t}{Close_t}-1
    </script></p>
</li>
<li><p>LCVOL&#xFF08;&#x5356;&#x51FA;&#x201C;&#x53CD;&#x5F39;&#x201D;&#x5360;&#x6BD4;&#xFF09;&#x201C;&#x6709;&#x591A;&#x5C11;&#x5356;&#x5355;&#x662F;&#x5728;&#x4F4E;&#x4E8E;&#x6536;&#x76D8;&#x4EF7;&#x7684;&#x4EF7;&#x4F4D;&#x6210;&#x4EA4;&#x7684;&#xFF1F;&#x201D;</p>
<p>&#x76F4;&#x89C9;&#xFF1A;&#x76D8;&#x4E2D;&#x4F4E;&#x4F4D;&#x629B;&#x538B;&#x8D8A;&#x96C6;&#x4E2D;&#xFF0C;&#x6536;&#x76D8;&#x88AB;&#x660E;&#x663E;&#x201C;&#x6536;&#x56DE;&#x201D;&#xFF0C;&#x6B21;&#x65E5;&#x66F4;&#x5BB9;&#x6613;&#x5EF6;&#x7EED;&#x53CD;&#x5F39;&#x6216;&#x81F3;&#x5C11;&#x56DE;&#x8865;&#x3002;
<script type="math/tex; mode=display">
    \text{LCVOL}_t \;=\; \frac{\sum_e volumeSell_{t,e}\,\mathbf 1\{p_{t,e}<Close_t\}} {\sum_e volume_{t,e}}
    </script></p>
</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_buy_sell_sentiment_factors</span><span class="hljs-params">(
    da: xr.DataArray,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-comment">#P48 59 91</span>
    p = da.sel(V1=<span class="hljs-string">&quot;robust&quot;</span>)
    vol = da.sel(V1=<span class="hljs-string">&quot;volume&quot;</span>)
    vbuy = da.sel(V1=<span class="hljs-string">&quot;volumeBuy&quot;</span>)
    vsell = da.sel(V1=<span class="hljs-string">&quot;volumeSell&quot;</span>)

    close_day = p.isel(E=<span class="hljs-number">-1</span>)
    close_b = close_day.broadcast_like(p)

    mask_above = p &gt; close_b
    num_hcvol = (vbuy.where(mask_above)).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    den_vol   = vol.sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    hcvol_day = divide_safe(num_hcvol, den_vol)
    hcvol = _ewm_ma_halflife(hcvol_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])

    w_price = (p * vbuy).where(mask_above)
    num_hcp = w_price.sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    den_hcp = (vbuy.where(mask_above)).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    avg_buy_above = divide_safe(num_hcp, den_hcp)
    hcp_day = divide_safe(avg_buy_above, close_day) - <span class="hljs-number">1.0</span>
    hcp = _ewm_ma_halflife(hcp_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])

    mask_below = p &lt; close_b
    num_lcvol = (vsell.where(mask_below)).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    lcvol_day = divide_safe(num_lcvol, den_vol)
    lcvol = _ewm_ma_halflife(lcvol_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])

    names = [f<span class="hljs-string">&quot;hcvol_hl_{half_life:g}&quot;</span>, f<span class="hljs-string">&quot;hcp_hl{half_life}&quot;</span>, f<span class="hljs-string">&quot;lcvol_hl{half_life}&quot;</span>]
    out = xr.concat([hcvol, hcp, lcvol], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=names)
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
<li><p>&#x4E3B;&#x52A8;&#x5360;&#x6BD4;</p>
<ul>
<li>&#x601D;&#x60F3;&#xFF1A;&#x628A;&#x201C;&#x5F53;&#x5206;&#x949F;&#x66F4;&#x53EF;&#x80FD;&#x662F;&#x4E3B;&#x52A8;&#x4E70;&#x7684;&#x5F3A;&#x5F31;&#x201D;&#x7F16;&#x7801;&#x4E3A;&#x6743;&#x91CD; <script type="math/tex; ">w\in[0,1]</script>&#xFF08;&#x7531;return&#x7684;&#x5927;&#x5C0F;&#x51B3;&#x5B9A;&#xFF09;&#xFF0C;&#x518D;&#x7528;&#x8BE5;&#x6743;&#x91CD;&#x5BF9;&#x5206;&#x949F;&#x6210;&#x4EA4;&#x989D;&#x52A0;&#x6743;&#xFF1B;&#x6743;&#x91CD;&#x5927;&#x3001;&#x91D1;&#x989D;&#x5927;&#x2192;&#x66F4;&#x504F;&#x201C;&#x4E3B;&#x52A8;&#x4E70;&#x5165;&#x201D;&#x3002;</li>
<li>T &#x5206;&#x5E03; / &#x6734;&#x7D20;&#xFF1A;&#x7528;&#x6807;&#x51C6;&#x5316;&#xFF08;&#x5BF9;&#x5206;&#x949F;&#x5E8F;&#x5217;&#x7684;&#x5F53;&#x65E5;&#x6807;&#x51C6;&#x5DEE;&#xFF09;&#x540E;&#x8F6C;&#x5316;&#x6210; t &#x5206;&#x5E03;&#xFF0C;&#x5C3E;&#x90E8;&#x66F4;&#x80A5;&#xFF0C;&#x5BF9;&#x6781;&#x7AEF;&#x5206;&#x65F6;&#x6DA8;&#x8DCC;&#x66F4;&#x654F;&#x611F;&#xFF1B;df_t &#x8D8A;&#x5C0F;&#x8D8A;&#x5F3A;&#x8C03;&#x6781;&#x7AEF;&#x3002;</li>
<li>&#x5747;&#x5300;&#x5206;&#x5E03;&#xFF1A;&#x628A;&#x6536;&#x76CA;&#x5939;&#x5728; [-L, L] &#x5185;&#x505A;&#x7EBF;&#x6027;&#x6620;&#x5C04;&#xFF0C;&#x7B80;&#x5355;&#x7A33;&#x5065;&#xFF1B;ret_limit &#x9ED8;&#x8BA4; 0.10&#xFF08;&#xB1;10%&#xFF09;&#x3002;</li>
<li>&#x7F6E;&#x4FE1;&#x6B63;&#x6001;&#xFF1A;&#x628A; <script type="math/tex; ">\pm L</script> &#x5BF9;&#x5E94;&#x5230;&#x6B63;&#x6001;&#x7684; <script type="math/tex; ">\pm1.96\sigma</script>&#xFF0C;&#x7B49;&#x4EF7;&#x4E8E;&#x7F6E;&#x4FE1;&#x5EA6;&#x7684;&#x523B;&#x753B;&#xFF0C;&#x9002;&#x5408;&#x5BF9;&#x201C;&#x6781;&#x7AEF;&#x8FD1;&#x6DA8;&#x505C;&#x201D;&#x7684;&#x533A;&#x5206;&#x3002;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_acs_family</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
    df_t: float = <span class="hljs-number">5.0</span>,
    ret_limit: float = <span class="hljs-number">0.10</span>
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-comment"># 63 66 67 74</span>
    r   = da.sel(V1=ret_var)
    px  = da.sel(V1=<span class="hljs-string">&quot;robust&quot;</span>)
    amt = da.sel(V1=<span class="hljs-string">&quot;locVol&quot;</span>)
    denom = amt.sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)

    std_r = r.std(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    z_t   = divide_safe(r, std_r)
    w_t   = xr.apply_ufunc(<span class="hljs-keyword">lambda</span> z: scipy.stats.t.cdf(z, df=df_t), z_t).clip(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>)                                 <span class="hljs-comment"># S x D x E</span>
    num_t = (amt * w_t).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    share_t_day = divide_safe(num_t, denom)
    share_t = _ewm_ma_halflife(share_t_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])

    w_u = ((r + ret_limit) / (<span class="hljs-number">2.0</span> * ret_limit)).clip(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>)
    num_u = (amt * w_u).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    share_uniform_day = divide_safe(num_u, denom)
    share_uniform = _ewm_ma_halflife(share_uniform_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])

    z_c = (r / ret_limit) * <span class="hljs-number">1.96</span>
    w_c = xr.apply_ufunc(<span class="hljs-keyword">lambda</span> z: scipy.stats.norm.cdf(z), z_c).clip(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>)
    num_c = (amt * w_c).sum(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    share_conf_day = divide_safe(num_c, denom)
    share_conf = _ewm_ma_halflife(share_conf_day, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])

    names = [ f<span class="hljs-string">&quot;active_tshare_hl{half_life}&quot;</span>, f<span class="hljs-string">&quot;active_uniform_share_hl{half_life}&quot;</span>, f<span class="hljs-string">&quot;active_confnorm_share_hl{half_life}&quot;</span>, ]
    out = xr.concat([share_t, share_uniform, share_conf], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=names)
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
<li><p>&#x8000;&#x773C;&#x6CE2;&#x52A8;&#x7387;/&#x6536;&#x76CA;&#x7387;</p>
<ul>
<li>&#x7528;&#x5206;&#x949F;&#x603B;&#x91CF;volume&#x505A;&#x73AF;&#x6BD4;&#x5DEE;&#x5206;&#xFF1A;<script type="math/tex; ">\Delta V_{t,e}=V_{t,e}-V_{t,e-1}</script>&#x3002;&#x5B9A;&#x4E49;&#x6210;&#x4EA4;&#x91CF;&#x6FC0;&#x589E;&#x65F6;&#x523B; n&#xFF1A;<script type="math/tex; ">\Delta V_{t,e}>\overline{\Delta V}{t,\cdot}+1\,\sigma(\Delta V{t,\cdot})</script>&#xFF08;&#x540C;&#x65E5;&#x3001;&#x5206;&#x949F;&#x7EF4;&#x5EA6;&#x5747;&#x503C;&#x4E0E;&#x6807;&#x51C6;&#x5DEE;&#xFF09;&#x3002;</li>
<li>&#x8000;&#x773C;&#x6CE2;&#x52A8;&#x7387;&#xFF1A;&#x5BF9;&#x6BCF;&#x4E2A;&#x6FC0;&#x589E;&#x65F6;&#x523B; n&#xFF0C;&#x53D6;&#x968F;&#x540E;&#x7684;5 &#x4E2A; 1 &#x5206;&#x949F;&#x533A;&#x95F4; [n, n+4] &#x7684;&#x6536;&#x76CA;&#x7387;&#x6807;&#x51C6;&#x5DEE;&#xFF1B;&#x65E5;&#x5185;&#x5BF9;&#x6240;&#x6709; n &#x53D6;&#x5747;&#x503C;&#xFF1B;&#x8000;&#x773C;&#x6536;&#x76CA;&#x7387;&#xFF1A;&#x5BF9;&#x6BCF;&#x4E2A;&#x6FC0;&#x589E;&#x65F6;&#x523B; n&#xFF0C;&#x53D6;&#x8BE5;&#x5206;&#x949F;&#x6536;&#x76CA;&#x7387;<script type="math/tex; "> r_{t,n}</script>&#xFF1B;&#x65E5;&#x5185;&#x5BF9;&#x6240;&#x6709; n &#x53D6;&#x5747;&#x503C;&#x3002;</li>
<li>&#x518D;&#x505A;&#x6A2A;&#x622A;&#x9762;&#x53BB;&#x5747;&#x503C;&#x5E76;&#x53D6;&#x7EDD;&#x5BF9;&#x503C; <script type="math/tex; ">\;|x_{t,i}-\overline{x}_{t,\cdot}|</script>&#x3002;</li>
</ul>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">compute_spark_factors</span><span class="hljs-params">(
    da: xr.DataArray,
    ret_var: str = <span class="hljs-string">&quot;ret&quot;</span>,
    half_life: float = <span class="hljs-number">10.0</span>,
)</span> -&gt; xr.DataArray:</span>
    <span class="hljs-comment">#62 79</span>
    r  = da.sel(V1=ret_var).isel(E=slice(<span class="hljs-number">1</span>, <span class="hljs-number">-1</span>))
    v  = da.sel(V1=<span class="hljs-string">&quot;volume&quot;</span>).diff(<span class="hljs-string">&quot;E&quot;</span>).isel(E=slice(<span class="hljs-number">1</span>, <span class="hljs-number">-1</span>))

    mu_dv  = v.mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    sd_dv  = v.std(<span class="hljs-string">&quot;E&quot;</span>,  skipna=<span class="hljs-keyword">True</span>)
    thr    = (mu_dv + sd_dv).broadcast_like(v)
    spike  = v &gt; thr

    std5_trail = r.rolling(E=<span class="hljs-number">5</span>, min_periods=<span class="hljs-number">3</span>).std()
    std5_fwd   = std5_trail.shift(E=<span class="hljs-number">-4</span>)
    spark_vol_day = std5_fwd.where(spike).mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)

    spark_ret_day = r.where(spike).mean(<span class="hljs-string">&quot;E&quot;</span>, skipna=<span class="hljs-keyword">True</span>)

    sv_cs = spark_vol_day.mean(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    sr_cs = spark_ret_day.mean(<span class="hljs-string">&quot;S&quot;</span>, skipna=<span class="hljs-keyword">True</span>)
    spark_vol_mod = np.abs(spark_vol_day - sv_cs)
    spark_ret_mod = np.abs(spark_ret_day - sr_cs)

    spark_vol = _ewm_ma_halflife(spark_vol_mod, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])
    spark_ret = _ewm_ma_halflife(spark_ret_mod, dim=<span class="hljs-string">&quot;D&quot;</span>, half_life=half_life, mode=<span class="hljs-string">&quot;mean&quot;</span>).isel(D=[<span class="hljs-number">-1</span>])

    names = [f<span class="hljs-string">&quot;spark_vol_hl{half_life}&quot;</span>, f<span class="hljs-string">&quot;spark_ret_hl{half_life}&quot;</span>]
    out = xr.concat([spark_vol, spark_ret], dim=<span class="hljs-string">&quot;V1&quot;</span>).assign_coords(V1=names)
    <span class="hljs-keyword">return</span> out.transpose(<span class="hljs-string">&quot;S&quot;</span>, <span class="hljs-string">&quot;D&quot;</span>, <span class="hljs-string">&quot;V1&quot;</span>)
</code></pre>
</li>
</ul>
<h1 id="risk-factor"><a name="risk-factor" class="anchor-navigation-ex-anchor" href="#risk-factor"><i class="fa fa-link" aria-hidden="true"></i></a> Risk Factor</h1>
<ul>
<li><p>Semi-beta</p>
<ul>
<li>&#x57FA;&#x4E8E;&#x4E2A;&#x80A1;&#x6536;&#x76CA;&#x548C;&#x5E02;&#x573A;&#x57FA;&#x51C6;&#x6536;&#x76CA;&#x65B9;&#x5411;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x53EF;&#x5C06;&#x4F20;&#x7EDF; Beta &#x56E0;&#x5B50;&#x62C6;&#x89E3;&#x4E3A; 4 &#x4E2A;&#x90E8;&#x5206;&#x3002;&#x4EE5;&#x4E0B;&#x5C55;&#x793A;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x56E0;&#x5B50; (&#x56DB;&#x79CD;&#x90FD;&#x53EF;&#x4EE5;&#x4F5C;&#x4E3A;beta measure)&#xFF1A;&#x5BF9;&#x5E94;&#x5E02;&#x573A;&#x6536;&#x76CA;&#x548C;&#x8D44;&#x4EA7;&#x6536;&#x76CA;&#x540C;&#x4E3A;&#x6B63;&#x7684;&#x60C5;&#x51B5;&#xFF0C;&#x5728; A &#x80A1;&#x5E02;&#x573A;&#x8BE5;&#x56E0;&#x5B50;&#x7684;&#x8D1F;&#x6EA2;&#x4EF7;&#x66F4;&#x660E;&#x663E;&#x3002;
<script type="math/tex; mode=display">
    \begin{gathered}
    \hat{\beta}_{t, i}^P=\frac{\sum_{k=1}^m r_{t, k, i}^{+} f_{t, k}^{+}}{\sum_{k=1}^m f_{t, k}^2} \\
    r_{t, k, i}^{+}=\max \left(r_{t, k, i}, 0\right) \\
    f_{l, k}^{+}=\max \left(f_{t, k}, 0\right)
    \end{gathered}
    </script>
&#x5176;&#x4E2D;
&#xFF08;1&#xFF09;<script type="math/tex; ">r_{t, k, i}</script> &#x4E3A;&#x80A1;&#x7968; i &#x5728;&#x4EA4;&#x6613;&#x65E5; t &#x5185;&#x7B2C; k &#x4E2A;&#x533A;&#x95F4;&#x7684;&#x6536;&#x76CA;&#x7387;&#x6570;&#x636E;&#xFF1B;
&#xFF08;2&#xFF09;<script type="math/tex; ">f_{t, k}</script> &#x4E3A;&#x5E02;&#x573A;&#x57FA;&#x51C6;&#x5728;&#x4EA4;&#x6613;&#x65E5; t &#x5185;&#x7B2C; k &#x4E2A;&#x533A;&#x95F4;&#x7684;&#x6536;&#x76CA;&#x7387;&#x6570;&#x636E;&#xFF0C;&#x5E02;&#x573A;&#x57FA;&#x51C6;&#x53EF;&#x4EE5;&#x4E3A;&#x6CAA;&#x6DF1; 300&#x3001;&#x4E2D;&#x8BC1; 500 &#x7B49;&#x6307;&#x6570;&#xFF1B;
&#xFF08;3&#xFF09;<script type="math/tex; ">m</script> &#x4E3A;&#x4EA4;&#x6613;&#x65E5;t&#x5185;&#x7684;&#x65F6;&#x95F4;&#x533A;&#x95F4;&#x6570;&#x91CF;&#x3002;</li>
</ul>
</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="mln.html" class="navigation navigation-prev " aria-label="Previous page: Machine Learning Notes">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../notes/temp.html" class="navigation navigation-next " aria-label="Next page: Reading Todo List">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Factor Calendar","level":"1.2.13","depth":2,"next":{"title":"Reading Todo List","level":"1.2.14","depth":2,"path":"notes/temp.md","ref":"./notes/temp.md","articles":[]},"previous":{"title":"Machine Learning Notes","level":"1.2.12","depth":2,"path":"contents/mln.md","ref":"./contents/mln.md","articles":[]},"dir":"ltr"},"config":{"plugins":["mathjax","image-captions","github","anchors","anchor-navigation-ex","-sharing","sharing-plus@^0.0.2","github-buttons","embed-pdf","livereload"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/ZizouHe/"},"livereload":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"fa fa-hand-o-right","level2Icon":"fa fa-hand-o-right","level3Icon":"fa fa-hand-o-right","showLevelIcon":false},"mode":"float","multipleH1":false,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":true,"showLevel":true},"github-buttons":{"buttons":[{"user":"ZizouHe","repo":"reading-notes","type":"star","size":"small"}]},"mathjax":{"forceSVG":false,"version":"2.6-latest"},"sharing":{"qq":true,"all":["facebook","google","twitter","weibo","qq","linkedin"],"douban":false,"facebook":true,"weibo":true,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":false,"messenger":false,"line":false,"vk":false,"pocket":false,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{},"embed-pdf":{},"image-captions":{"caption":"Figure _PAGE_IMAGE_NUMBER_. _CAPTION_","align":"right","variable_name":"_pictures"}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"_pictures":[{"backlink":"./notes/RDN.html#fig1.4.2.1","level":"1.4.2","align":"right","list_caption":"Figure: Example (a) data graph and (b) model graph.","alt":"Example (a) data graph and (b) model graph.","nro":1,"url":"./pic/RDN-1.png","index":1,"caption_template":"Figure _PAGE_IMAGE_NUMBER_. _CAPTION_","label":"Example (a) data graph and (b) model graph.","attributes":{},"skip":false,"key":"1.4.2.1"},{"backlink":"./notes/RDN.html#fig1.4.2.2","level":"1.4.2","align":"right","list_caption":"Figure: RDN inference algorithm.","alt":"RDN inference algorithm.","nro":2,"url":"./pic/RDN-2.png","index":2,"caption_template":"Figure _PAGE_IMAGE_NUMBER_. _CAPTION_","label":"RDN inference algorithm.","attributes":{},"skip":false,"key":"1.4.2.2"},{"backlink":"./notes/Faster_Frank_Wolfe.html#fig1.4.14.1","level":"1.4.14","align":"right","list_caption":"Figure: Frank-Wolfe Algorithm","alt":"Frank-Wolfe Algorithm","nro":3,"url":"./pic/Frank-Wolfe.png","index":1,"caption_template":"Figure _PAGE_IMAGE_NUMBER_. _CAPTION_","label":"Frank-Wolfe Algorithm","attributes":{},"skip":false,"key":"1.4.14.1"},{"backlink":"./notes/Fin_Fan_Book.html#fig1.4.15.1","level":"1.4.15","align":"right","list_caption":"Figure: Efficient Frontier with risk-free asset","alt":"Efficient Frontier with risk-free asset","nro":4,"url":"./pic/Eff_Front_1.png","index":1,"caption_template":"Figure _PAGE_IMAGE_NUMBER_. _CAPTION_","label":"Efficient Frontier with risk-free asset","attributes":{},"skip":false,"key":"1.4.15.1"},{"backlink":"./notes/Fin_Fan_Book.html#fig1.4.15.2","level":"1.4.15","align":"right","list_caption":"Figure: Efficient Frontier without risk-free asset","alt":"Efficient Frontier without risk-free asset","nro":5,"url":"./pic/Eff_Front_2.png","index":2,"caption_template":"Figure _PAGE_IMAGE_NUMBER_. _CAPTION_","label":"Efficient Frontier without risk-free asset","attributes":{},"skip":false,"key":"1.4.15.2"}]},"title":"Reading List & Notes","gitbook":"*"},"file":{"path":"contents/factor_cal.md","mtime":"2025-08-30T09:12:33.187Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2025-08-30T09:12:52.334Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

